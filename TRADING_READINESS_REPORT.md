# 매매 준비 상태 점검 리포트
**생성일시**: 2025-12-05 10:22
**점검자**: Claude Code

---

## ✅ 1. 시간 설정 (통일 완료)

### 매수 시간 제한
- **설정**: 10:00 ~ 14:59
- **적용 위치** (3곳 모두 확인):
  1. `main_auto_trading.py:1480` ✅
  2. `main_auto_trading.py:2662` ✅
  3. `analyzers/signal_orchestrator.py:171` ✅

### 매도 시간
- **설정**: 09:00 ~ 15:30 (제한 없음, 장 시작부터 가능)
- **위치**: `check_exit_signal()` - 시간 제한 없이 동작

---

## ✅ 2. 감시 종목 리스트

### 현재 상태
- **종목 수**: 15개
- **파일**: `data/watchlist.json` (백업에서 복원 완료)
- **손상 파일**: 수정 완료

### 주요 종목
1. 한올바이오파마 (009420) - 승률 100%, PF 158
2. 공구우먼 (366030) - 승률 66.7%, PF 4.79
3. 메드팩토 (235980) - 승률 60%, PF 1.39
4. ... 외 12개

---

## ✅ 3. Risk Management 설정

### 손절 설정
- **Hard Stop Loss**: -2.5%
- **Technical Stop**: -1.5%
- **Early Failure Cut**: 10분 이내 -0.5% (활성화)

### 일일 한도
- **Max Daily Loss**: 3.0%
- **Max Positions**: 3개 (동시 보유)
- **Max Trades/Day**: 7회

### 부분 청산
- **1차**: +4%에 40% 청산
- **2차**: +6%에 40% 청산
- **트레일링**: 나머지 20%는 ATR 트레일링

---

## ⚠️ 4. 필터 강도 분석

### L0 시스템 필터
- ✅ 시간 제한: 10:00~14:59
- ✅ 일일 손실 한도: -3.0%
- ✅ 주말 거래 차단

### L1 장세 필터 (VolatilityRegimeDetector)
- 변동성 체제 감지
- 고변동성 시장: 차단 가능
- **영향**: 중간

### L2 RS 필터 (조건검색 단계)
- **min_rs_rating**: 80 (상위 20%)
- **영향**: **높음** ⚠️
- **조건검색에서 이미 필터링됨**

### L3 MTF Consensus (필수 통과)
- 다중 시간프레임 합의
- **영향**: 높음
- 실패 시 거부

### L4 Liquidity Shift (선택사항)
- 기관/외인 수급 전환
- **영향**: 낮음 (없어도 진행 가능)

### L5 Squeeze Momentum (선택사항)
- Bollinger Band + Keltner Channel
- **영향**: 낮음 (없어도 진행 가능)

### L6 Pre-Trade Validator (필수 통과)
- **min_win_rate**: 40%
- **min_trades**: 2회
- **min_profit_factor**: 1.15
- **lookback_days**: 5일
- **영향**: **높음** ⚠️

### CONFIDENCE 집계
- **임계값**: 0.4
- L3, L4, L5, L6의 신뢰도를 가중 평균
- **영향**: 높음

### ALPHA 점수
- **임계값**: 0.8
- 8개 알파의 가중 평균
- **영향**: **매우 높음** ⚠️

---

## 🎯 5. 매매 발생 가능성 평가

### 현재 시각 기준
- **시간**: 10:20 (매수 가능 시간) ✅
- **요일**: 목요일 ✅

### 주요 차단 요인

#### 🔴 높은 확률로 차단될 수 있는 필터
1. **L2 RS 필터**: min_rs_rating=80 (상위 20%)
   - 조건검색에서 이미 필터링되므로 watchlist에는 통과한 종목만 있음
   - **영향**: 낮음 (이미 통과)

2. **L6 Pre-Trade Validator**: 백테스트 성능 검증
   - 최근 5일간 승률 40% 이상, PF 1.15 이상 필요
   - **영향**: 높음 (백테스트 통과 필요)

3. **ALPHA 점수**: aggregate_score > 0.8
   - 8개 알파의 종합 점수
   - **영향**: 매우 높음 (가장 엄격)

#### 🟡 중간 확률로 차단될 수 있는 필터
1. **L3 MTF Consensus**: 다중 시간프레임 합의
   - **영향**: 중간

2. **CONFIDENCE**: 전체 신뢰도 0.4 이상
   - **영향**: 중간

#### 🟢 낮은 확률로 차단
1. **L0 시스템 필터**: 시간/손실 한도 (정상 운영 시 통과)
2. **L1 장세 필터**: 극단적 변동성 아니면 통과
3. **L4, L5**: 선택사항 (없어도 진행)

---

## 📊 6. 매매 발생 시나리오

### 시나리오 A: 정상 매매 (확률: 중)
```
1. 조건검색으로 RS 80 이상 종목 발견
2. 기술적 조건 충족 (VWAP, MA20, 거래량)
3. L3 MTF 통과 (다중 시간프레임 상승)
4. L6 백테스트 통과 (승률 40% 이상)
5. ALPHA 점수 > 0.8
6. CONFIDENCE > 0.4
→ ✅ 매수 실행
```

### 시나리오 B: L6 차단 (확률: 중)
```
1~3. 동일
4. L6 실패 (최근 5일 백테스트 승률 낮음)
→ ❌ "L6 Pre-Trade Validator 실패" 거부
```

### 시나리오 C: ALPHA 차단 (확률: 높음)
```
1~4. 통과
5. ALPHA 점수 0.5 (임계값 0.8 미달)
→ ❌ "Multi-Alpha 점수 부족" 거부
```

---

## 🔧 7. 매매 확률 향상을 위한 조정 방안

### 즉시 적용 가능 (설정 완화)

#### 옵션 1: ALPHA 임계값 완화
```python
# analyzers/signal_orchestrator.py:563
ALPHA_THRESHOLD = 0.8  # → 0.5로 낮추기
```
**효과**: 매매 발생 확률 ↑↑

#### 옵션 2: L6 기준 완화
```python
# analyzers/signal_orchestrator.py:106-112
self.validator = PreTradeValidatorV2(
    min_win_rate=40.0,        # → 30.0
    min_trades=2,             # → 1
    min_profit_factor=1.15    # → 1.0
)
```
**효과**: 매매 발생 확률 ↑

#### 옵션 3: CONFIDENCE 임계값 완화
```python
# trading/confidence_aggregator.py
# aggregate() 메서드의 임계값 0.4 → 0.3
```
**효과**: 매매 발생 확률 ↑

### ⚠️ 주의사항
- **설정 완화 = 리스크 증가**
- 실전 운영 전 충분한 백테스트 필요
- 소액으로 테스트 후 점진적 확대 권장

---

## ✅ 8. 최종 체크리스트

### 필수 확인 사항
- [x] 매수 시간 제한 (10:00 이후) 3곳 모두 적용
- [x] 감시 종목 리스트 복원 (15개)
- [x] Risk Management 설정 확인
- [x] 필터 강도 분석 완료
- [ ] **Kiwoom API 연결 확인** (런타임)
- [ ] **계좌 잔고 확인** (런타임)
- [ ] **조건검색 동작 확인** (런타임)

### 실행 전 권장 사항
1. **로그 모니터링**: `logs/signal_orchestrator.log` 확인
2. **드라이런 테스트**: 실제 주문 없이 시그널만 체크
3. **소액 테스트**: 첫 매매는 최소 금액으로
4. **필터 완화 여부 결정**: ALPHA 임계값 조정 고려

---

## 🎯 9. 결론

### 현재 상태
- **시간 설정**: ✅ 완료 (10:00 이후 매수)
- **데이터**: ✅ 정상 (감시 종목 15개)
- **필터 강도**: ⚠️ **매우 엄격** (ALPHA > 0.8)

### 매매 발생 가능성
- **현재 설정**: **중~낮음** (필터가 엄격함)
- **ALPHA 임계값 완화 시**: **중~높음**

### 권장 조치
1. **즉시 실행 가능**: 현재 설정으로 run.sh 실행
2. **매매 미발생 시**: ALPHA_THRESHOLD를 0.8 → 0.6으로 완화
3. **지속 미발생 시**: L6 기준 완화 (min_win_rate 40% → 30%)

### 다음 단계
```bash
# 1. 프로그램 실행
./run.sh

# 2. 로그 모니터링 (별도 터미널)
tail -f logs/signal_orchestrator.log

# 3. 시그널 발생 여부 확인
# - "✅ ACCEPT" 로그가 나오면 매수 진행
# - "❌ REJECT" 로그만 나오면 필터 완화 검토
```

---

**작성**: Claude Code
**최종 수정**: 2025-12-05 10:22
