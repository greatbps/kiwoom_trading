================================================================================
ğŸ”¥ CRITICAL: ì²­ì‚° ë¡œì§ ì¹˜ëª…ì  ë¬¸ì œ ë° í•´ê²°ì±…
================================================================================

ì‘ì„±ì¼: 2025-11-17
ë¶„ì„ ê¸°ë°˜: 7ì¼ê°„ 61ê±´ ì‹¤ê±°ë˜ ë°ì´í„°
í˜„ì¬ ì†ìµ: -5,470ì› (ì†ì‹¤)
ëª©í‘œ: +1~3% ê³„ì¢Œ ìˆ˜ìµìœ¼ë¡œ ì „í™˜

================================================================================
ğŸ“Š í•µì‹¬ ë¬¸ì œ ì§„ë‹¨
================================================================================

**ì´í‰**: ìŠ¹ë¥ ì€ 50~60%ë¡œ ë‚˜ì˜ì§€ ì•Šìœ¼ë‚˜, ì†ìµë¹„ 0.2~0.3ìœ¼ë¡œ êµ¬ì¡°ì  ì‹¤íŒ¨

ë¬¸ì œ ìš”ì•½:
í•­ëª©                í˜„ì¬ ê°’          ì •ìƒ ê°’
í‰ê·  ìˆ˜ìµë¥          +0.6%           +1.5~2.0%
í‰ê·  ì†ì‹¤ë¥          -1.1%           -0.5% ì´ë‚´
ì†ìµë¹„ (RR)         0.2~0.3         1.0~1.5
15:00 ì²­ì‚° ë¹„ìœ¨     70%+            20% ì´í•˜
ë¶€ë¶„ì²­ì‚° ë°œìƒ       0ê±´             30~40%
íŠ¸ë ˆì¼ë§ í‰ê· ìˆ˜ìµ   +0.6%           +2.0%+

================================================================================
ğŸ”¥ ë°œê²¬ëœ 5ê°€ì§€ ì¹˜ëª…ì  ë¬¸ì œ
================================================================================

âŒ ë¬¸ì œ 1: ë¶€ë¶„ ì²­ì‚°ì´ ë‹¨ 1ê±´ë„ ë°œìƒí•˜ì§€ ì•ŠìŒ
-------------------

**ì¦ê±°**:
- 7ì¼ê°„ 61ê±´ ê±°ë˜ ì¤‘ ë¶€ë¶„ì²­ì‚° 0ê±´
- ì„¤ì •: +2.5%, +4.5%, +7.0% 3ë‹¨ê³„
- ì‹¤ì œ: ëŒ€ë¶€ë¶„ +0.6% ìˆ˜ì¤€ì—ì„œ íŠ¸ë ˆì¼ë§ìœ¼ë¡œ ì¢…ë£Œ

**ì›ì¸**:
```yaml
# config/strategy_hybrid.yaml:71-76
partial_exit:
  enabled: true
  tiers:
    - profit_pct: 2.5   # âŒ ë„ˆë¬´ ë†’ìŒ
      exit_ratio: 0.3
    - profit_pct: 4.5   # âŒ ë„ˆë¬´ ë†’ìŒ
      exit_ratio: 0.4
```

**ì½”ë“œ ê²€ì¦**:
```python
# trading/exit_logic_optimized.py:165-178
if self.partial_exit_enabled:
    partial_stage = position.get('partial_exit_stage', 0)

    for idx, tier in enumerate(reversed(self.partial_tiers), start=1):
        tier_num = len(self.partial_tiers) - idx + 1

        if partial_stage < tier_num and profit_pct >= tier['profit_pct']:  # âœ… ë¡œì§ ì •ìƒ
            return False, f"ë¶€ë¶„ì²­ì‚° {tier_num}ì°¨ ì¤€ë¹„", {
                'partial_exit': True,
                'stage': tier_num,
                'exit_ratio': tier['exit_ratio'],
                'profit_pct': profit_pct
            }
```

ë¡œì§ì€ ì •ìƒì´ì§€ë§Œ, ì„ê³„ê°’ì´ í˜„ì‹¤ê³¼ ë™ë–¨ì–´ì§:
- ìˆ˜ìµ 2% ì´ìƒ ê±°ë˜: 61ê±´ ì¤‘ ë‹¨ 2ê±´ (3%)
- +2.5% ë„ë‹¬ë¥ : ê±°ì˜ 0%

**í•´ê²°ì±…**:
```yaml
partial_exit:
  enabled: true
  tiers:
    - profit_pct: 1.0   # 2.5 â†’ 1.0 (ë¹ ë¥¸ ì‹¤í˜„)
      exit_ratio: 0.3
    - profit_pct: 2.0   # 4.5 â†’ 2.0 (ì¤‘ê°„ ì‹¤í˜„)
      exit_ratio: 0.4
    - profit_pct: 3.5   # 7.0 â†’ 3.5 (ëŒ€ë°• ì¤€ë¹„)
      exit_ratio: 0.2
```


âŒ ë¬¸ì œ 2: íŠ¸ë ˆì¼ë§ ìŠ¤íƒ‘ì´ ë„ˆë¬´ ì´˜ì´˜í•¨
-------------------

**ì¦ê±°**:
- íŠ¸ë ˆì¼ë§ìœ¼ë¡œ ì¢…ë£Œëœ ê±°ë˜ì˜ í‰ê·  ìˆ˜ìµ: +0.6%
- ì˜ˆ: ê³µêµ¬ìš°ë¨¼ +0.17%, +0.37%, +0.74%, +1.48%
- ìœ ì¼í•œ ì •ìƒ ê±°ë˜: ì‚¼ì„±ì¶œíŒì‚¬ +2.24%

**ì›ì¸**:
```yaml
# config/strategy_hybrid.yaml:80-82
trailing_stop:
  activation_profit_pct: 1.5   # âŒ ë„ˆë¬´ ë¹¨ë¦¬ í™œì„±í™”
  distance_pct: 1.0            # âŒ ë„ˆë¬´ ì´˜ì´˜í•¨
  min_lock_profit_pct: 0.5     # âŒ ìµœì†Œ ìˆ˜ìµì´ ë„ˆë¬´ ë‚®ìŒ
```

**ì½”ë“œ ê²€ì¦**:
```python
# trading/exit_logic_optimized.py:185-205
if position.get('trailing_active') or profit_pct >= self.trailing_activation:
    position['trailing_active'] = True

    # íŠ¸ë ˆì¼ë§ ìŠ¤íƒ‘ ë¼ì¸ ê³„ì‚°
    trailing_stop_price = highest_price * (1 - self.trailing_distance / 100)  # -1.0%

    # ìµœì†Œ ì ê¸ˆ ìˆ˜ìµ ë³´ì¥
    min_lock_price = entry_price * (1 + self.trailing_min_lock / 100)  # +0.5%
    trailing_stop_price = max(trailing_stop_price, min_lock_price)

    # íŠ¸ë ˆì¼ë§ ìŠ¤íƒ‘ ë°œë™ ì²´í¬
    if current_price <= trailing_stop_price:
        return True, f"íŠ¸ë ˆì¼ë§ ìŠ¤íƒ‘ ({profit_pct:+.2f}%)", {...}
```

ì‹œë‚˜ë¦¬ì˜¤ ë¶„ì„:
```
ì§„ì…ê°€: 10,000ì›
í˜„ì¬ê°€: 10,150ì› (+1.5% â†’ íŠ¸ë ˆì¼ë§ í™œì„±í™”)
highest_price: 10,150ì›
trailing_stop: 10,150 * 0.99 = 10,048ì› (+0.48%)
min_lock: 10,000 * 1.005 = 10,050ì› (+0.5%)
â†’ ì‹¤ì œ stop: 10,050ì›

ê°€ê²© 10,100ì› â†’ 10,050ì› í•˜ë½ ì‹œ
â†’ íŠ¸ë ˆì¼ë§ ë°œë™, +0.5% ìˆ˜ìµìœ¼ë¡œ ì²­ì‚°
```

ì´ê²Œ ë°”ë¡œ "+0.17%, +0.37%" ê°™ì€ ë¯¸ë¯¸í•œ ìˆ˜ìµì˜ ì›ì¸!

**í•´ê²°ì±…**:
```yaml
trailing_stop:
  activation_profit_pct: 2.0   # 1.5 â†’ 2.0 (ë” ì—¬ìœ ìˆê²Œ)
  distance_pct: 1.5            # 1.0 â†’ 1.5 (ë” ë„‰ë„‰í•˜ê²Œ)
  min_lock_profit_pct: 1.0     # 0.5 â†’ 1.0 (ìµœì†Œ +1% ë³´ì¥)
```


âŒ ë¬¸ì œ 3: ì´ˆê¸° ì‹¤íŒ¨ ì»·ì´ ëŠ¦ê²Œ ì‘ë™í•¨ (-0.8% ì„¤ì •ì¸ë° ì‹¤ì œ -1.1%)
-------------------

**ì¦ê±°**:
- í•œì˜¬ë°”ì´ì˜¤íŒŒë§ˆ: -1.21% (4.8ë¶„)
- ì¼ë™í™€ë”©ìŠ¤: -1.17%
- íŒŒë¡œìŠ¤ì•„ì´: -1.12%
- ì„¤ì •: -0.8%, ì‹¤ì œ: í‰ê·  -1.15%

**ì›ì¸**:
```yaml
# config/strategy_hybrid.yaml:63-66
early_failure:
  enabled: true
  window_minutes: 15
  loss_cut_pct: -0.8    # âŒ ì„¤ì •ì€ -0.8%ì¸ë°...
```

**ì½”ë“œ ê²€ì¦**:
```python
# trading/exit_logic_optimized.py:147-152
if self.early_failure_enabled and holding_minutes <= self.early_failure_window:
    if profit_pct <= self.early_failure_loss:  # âœ… ë¡œì§ ì •ìƒ
        return True, f"ì´ˆê¸° ì‹¤íŒ¨ ì»· ({holding_minutes:.1f}ë¶„, {profit_pct:.2f}%)", {...}
```

ë¡œì§ì€ ì •ìƒì´ì§€ë§Œ **ì²´í¬ ì£¼ê¸°ê°€ ë¬¸ì œ**:
```python
# main_auto_trading.py:1411
await asyncio.sleep(1)  # âœ… 1ì´ˆ ì£¼ê¸°
```

í•˜ì§€ë§Œ ì‹¤ì œ ë¬¸ì œëŠ”:
1. **í‚¤ì›€ APIëŠ” 5ë¶„ë´‰ ë°ì´í„° ì œê³µ** (1ë¶„ë´‰ì´ ì•„ë‹˜)
2. check_exit_signal()ì€ dfì˜ ìµœì‹  closeë¡œ íŒë‹¨
3. ë´‰ì´ ì™„ì„±ë˜ê¸° ì „ê¹Œì§€ëŠ” ì´ì „ ê°€ê²© ì‚¬ìš©
4. ì‹¤ì‹œê°„ ì²´ê²°ê°€ê°€ ì•„ë‹Œ **"ë´‰ ì¢…ê°€"** ê¸°ì¤€

ê²°ê³¼:
```
09:00:00 ì§„ì… 10,000ì›
09:00:30 í˜„ì¬ê°€ 9,920ì› (-0.8%) â†’ ì•„ì§ ì²´í¬ ì•ˆ ë¨ (ë´‰ ë¯¸ì™„ì„±)
09:01:00 í˜„ì¬ê°€ 9,910ì› â†’ ì²´í¬ ì‹œì‘
09:01:30 í˜„ì¬ê°€ 9,880ì› (-1.2%) â†’ ì´ì œì•¼ ì²´í¬ë¨!
â†’ ì†ì ˆ ë°œë™: -1.2%
```

**í•´ê²°ì±…**:
1. ì´ˆê¸° ì‹¤íŒ¨ ì»·ì„ -0.6%ë¡œ ê°•í™” (ìŠ¬ë¦¬í”¼ì§€ ê³ ë ¤)
2. ì‹¤ì‹œê°„ ì²´ê²°ê°€ ì²´í¬ ì¶”ê°€ (í˜„ì¬ ì‚¬ìš© ì•ˆ í•¨)

```yaml
early_failure:
  enabled: true
  window_minutes: 15
  loss_cut_pct: -0.6    # -0.8 â†’ -0.6 (ìŠ¬ë¦¬í”¼ì§€ 20% ê³ ë ¤)
```


âŒ ë¬¸ì œ 4: 15:00 ê°•ì œ ì²­ì‚°ì´ ë„ˆë¬´ ë§ìŒ (ì „ëµ ì‹¤íŒ¨ ì¦ê±°)
-------------------

**ì¦ê±°**:
- ëŒ€ë¶€ë¶„ì˜ í¬ì§€ì…˜ì´ 15:00ì— ì¢…ë£Œ
- ì¦‰, "ì „ëµì  ì²­ì‚°"ì´ ê±°ì˜ ì‘ë™í•˜ì§€ ì•ŠìŒ

**ì›ì¸**:
```yaml
# config/strategy_hybrid.yaml:89-91
time_based_exit:
  loss_breakeven_exit_time: "15:00:00"  # âŒ ë„ˆë¬´ ì´ë¦„
  final_force_exit_time: "15:10:00"
  loss_breakeven_threshold_pct: 0.3
```

**ì½”ë“œ ê²€ì¦**:
```python
# trading/exit_logic_optimized.py:126-132
# 15:10 - ëª¨ë“  í¬ì§€ì…˜ ê°•ì œ ì²­ì‚°
if current_time >= self.final_exit_time:
    return True, "ìµœì¢… ê°•ì œ ì²­ì‚° (15:10)", {'profit_pct': profit_pct}

# 15:00 - ì†ì‹¤/ë³¸ì „ í¬ì§€ì…˜ë§Œ ì²­ì‚°
if current_time >= self.loss_exit_time:
    if profit_pct <= self.loss_threshold:  # +0.3% ë¯¸ë§Œ
        return True, f"ì†ì‹¤/ë³¸ì „ ì •ë¦¬ (15:00, {profit_pct:+.2f}%)", {'profit_pct': profit_pct}
```

ë¬¸ì œì :
- 15:00ì€ ë‹¨íƒ€ ì „ëµì—ëŠ” ë„ˆë¬´ ëŠ¦ìŒ
- ì´ ì‹œê°„ê¹Œì§€ í¬ì§€ì…˜ì´ ë‚¨ì•„ìˆë‹¤ëŠ” ê²ƒ ìì²´ê°€ ë¹„ì •ìƒ

**í•´ê²°ì±…**:
```yaml
time_based_exit:
  loss_breakeven_exit_time: "14:30:00"  # 15:00 â†’ 14:30 (30ë¶„ ì•ë‹¹ê¹€)
  final_force_exit_time: "14:50:00"     # 15:10 â†’ 14:50 (20ë¶„ ì•ë‹¹ê¹€)
  loss_breakeven_threshold_pct: 0.5     # 0.3 â†’ 0.5 (ê¸°ì¤€ ìƒí–¥)
```


âŒ ë¬¸ì œ 5: -10.41% ëŒ€í­ë½ ì´ë²¤íŠ¸ (ì‹œìŠ¤í…œ ì•ˆì •ì„± ë¬¸ì œ)
-------------------

**ì¦ê±°**:
- ì¹´í‹°ìŠ¤: +0.09% ì—¬ëŸ¬ ë²ˆ â†’ ê°‘ìê¸° -10.41%

**ì›ì¸ (ì¶”ì •)**:
1. ì‹œì¥ê°€ ì£¼ë¬¸ ë¯¸ì²´ê²° í›„ ì§€ì •ê°€ ë³€í™˜ ì‹¤íŒ¨
2. ì²­ì‚° ë£¨í”„ ë¸”ë¡œí‚¹ (async/await ë¬¸ì œ)
3. API ë‹¨ì ˆ
4. í˜¸ê°€ì°½ í…… ë¹” (ë§¤ë„í˜¸ê°€ ì—†ìŒ)

**ì½”ë“œ ê²€ì¦**:
```python
# main_auto_trading.py:2559-2564
order_result = self.api.order_sell(
    stock_code=stock_code,
    quantity=partial_quantity,
    price=0,  # âŒ ì‹œì¥ê°€ ë§¤ë„ (ìœ„í—˜)
    trade_type="3"  # ì‹œì¥ê°€
)
```

ì‹œì¥ê°€ ë§¤ë„ì˜ ìœ„í—˜:
- í˜¸ê°€ì°½ì´ í…… ë¹ˆ ê²½ìš° â†’ í•˜í•œê°€ì— ì²´ê²° ê°€ëŠ¥
- ì €ìœ ë™ì„± ì¢…ëª© â†’ -10% ì†ì‹¤ ê°€ëŠ¥

**í•´ê²°ì±…**:
1. ì‹œì¥ê°€ â†’ ì§€ì •ê°€ ë³€ê²½ (í˜„ì¬ê°€ -0.5% ì§€ì •ê°€)
2. ë¯¸ì²´ê²° ì‹œ ì¬ì‹œë„ ë¡œì§ ì¶”ê°€
3. Emergency Hard Stopì—ì„œë§Œ ì‹œì¥ê°€ ì‚¬ìš©

```python
# ë¶€ë¶„ ë§¤ë„ ì£¼ë¬¸ ê°œì„ 
if emergency:
    price = 0  # ì‹œì¥ê°€
    trade_type = "3"
else:
    price = int(current_price * 0.995)  # í˜„ì¬ê°€ -0.5% ì§€ì •ê°€
    trade_type = "2"  # ì§€ì •ê°€

order_result = self.api.order_sell(
    stock_code=stock_code,
    quantity=quantity,
    price=price,
    trade_type=trade_type
)
```

================================================================================
âœ… ìµœì¢… í•´ê²°ì±… (5ê°€ì§€ ìˆ˜ì •)
================================================================================

1. config/strategy_hybrid.yaml ìˆ˜ì •
-----------------------------------

```yaml
partial_exit:
  enabled: true
  tiers:
    - profit_pct: 1.0      # 2.5 â†’ 1.0
      exit_ratio: 0.3
    - profit_pct: 2.0      # 4.5 â†’ 2.0
      exit_ratio: 0.4
    - profit_pct: 3.5      # 7.0 â†’ 3.5
      exit_ratio: 0.2

trailing_stop:
  activation_profit_pct: 2.0   # 1.5 â†’ 2.0
  distance_pct: 1.5            # 1.0 â†’ 1.5
  min_lock_profit_pct: 1.0     # 0.5 â†’ 1.0

risk_control:
  early_failure:
    enabled: true
    window_minutes: 15
    loss_cut_pct: -0.6    # -0.8 â†’ -0.6

time_based_exit:
  loss_breakeven_exit_time: "14:30:00"  # 15:00 â†’ 14:30
  final_force_exit_time: "14:50:00"     # 15:10 â†’ 14:50
  loss_breakeven_threshold_pct: 0.5     # 0.3 â†’ 0.5
```

2. main_auto_trading.py:2559-2564 ìˆ˜ì • (ì‹œì¥ê°€ â†’ ì§€ì •ê°€)
-----------------------------------------------------------

```python
def execute_partial_sell(self, stock_code: str, price: float, profit_pct: float, exit_ratio: float, stage: int):
    # ... (ê¸°ì¡´ ì½”ë“œ)

    # ì‹¤ì œ í‚¤ì›€ API ë¶€ë¶„ ë§¤ë„ ì£¼ë¬¸
    try:
        console.print(f"[yellow]ğŸ“¡ í‚¤ì›€ API ë¶€ë¶„ ë§¤ë„ ì£¼ë¬¸ ì „ì†¡ ì¤‘...[/yellow]")

        # ğŸ”§ CRITICAL FIX: ì‹œì¥ê°€ â†’ ì§€ì •ê°€ ë³€ê²½ (í˜¸ê°€ í……ë¹” ë°©ì§€)
        sell_price = int(price * 0.995)  # í˜„ì¬ê°€ -0.5% ì§€ì •ê°€

        order_result = self.api.order_sell(
            stock_code=stock_code,
            quantity=partial_quantity,
            price=sell_price,      # 0 â†’ sell_price
            trade_type="2"         # "3" â†’ "2" (ì§€ì •ê°€)
        )
```

3. execute_sell() ë™ì¼ ìˆ˜ì •
----------------------------

```python
def execute_sell(self, stock_code: str, price: float, profit_pct: float, exit_reason: str, use_market_order: bool = False):
    # ... (ê¸°ì¡´ ì½”ë“œ)

    # Emergency ìƒí™©ì—ì„œë§Œ ì‹œì¥ê°€
    if use_market_order:
        sell_price = 0
        trade_type = "3"
        console.print(f"[red]âš ï¸  ë¹„ìƒ ì‹œì¥ê°€ ë§¤ë„![/red]")
    else:
        sell_price = int(price * 0.995)  # í˜„ì¬ê°€ -0.5% ì§€ì •ê°€
        trade_type = "2"
        console.print(f"[yellow]ì§€ì •ê°€ {sell_price:,}ì› ë§¤ë„[/yellow]")

    order_result = self.api.order_sell(
        stock_code=stock_code,
        quantity=quantity,
        price=sell_price,
        trade_type=trade_type
    )
```

================================================================================
ğŸ“Š ì˜ˆìƒ ê°œì„  íš¨ê³¼
================================================================================

ìˆ˜ì • ì „:
í•­ëª©                í˜„ì¬ ê°’
í‰ê·  ìˆ˜ìµë¥          +0.6%
í‰ê·  ì†ì‹¤ë¥          -1.1%
ì†ìµë¹„ (RR)         0.2~0.3
15:00 ì²­ì‚°          70%+
ë¶€ë¶„ì²­ì‚°            0ê±´

ìˆ˜ì • í›„:
í•­ëª©                ì˜ˆìƒ ê°’        ê°œì„  íš¨ê³¼
í‰ê·  ìˆ˜ìµë¥          +1.5~2.0%     +250%
í‰ê·  ì†ì‹¤ë¥          -0.5%         -55%
ì†ìµë¹„ (RR)         1.0~1.5       +400%
15:00 ì²­ì‚°          20% ì´í•˜      -70%
ë¶€ë¶„ì²­ì‚°            30~40%        +ë¬´í•œ

ì˜ˆìƒ ê³„ì¢Œ ìˆ˜ìµ:
- 7ì¼ê°„ -5,470ì› â†’ +1~3% (+10,000~30,000ì›)
- ì›”ê°„ -20,000ì› â†’ +40,000~120,000ì›
- ì—°ê°„ -240,000ì› â†’ +480,000~1,440,000ì›

================================================================================
âš ï¸ ì ìš© ìš°ì„ ìˆœìœ„
================================================================================

ğŸ”¥ ì¦‰ì‹œ ì ìš© (Critical):
1. config/strategy_hybrid.yaml ìˆ˜ì • (5ë¶„)
2. main_auto_trading.py ì‹œì¥ê°€ â†’ ì§€ì •ê°€ (10ë¶„)

â±ï¸ ë‹¤ìŒ ë‹¨ê³„ (Important):
3. ì‹¤ì‹œê°„ ì²´ê²°ê°€ ì²´í¬ ì¶”ê°€ (30ë¶„)
4. ë¯¸ì²´ê²° ì¬ì‹œë„ ë¡œì§ (1ì‹œê°„)

================================================================================
