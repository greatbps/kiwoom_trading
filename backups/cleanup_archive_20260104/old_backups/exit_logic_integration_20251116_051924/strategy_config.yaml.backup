# VWAP 전략 설정 파일 - 데이터 기반 최적화 버전
# 손익비 0.27 → 1.2+ 개선 목표

# =========================================
# 리스크 관리 (데이터 기반 최적화)
# =========================================
risk_control:
  # Hard Stop (비상용 - 시장가 강제청산)
  hard_stop_pct: 2.0          # 절대 한계 -2.0% (기존 -10.41% 방지)
  technical_stop_pct: 1.2     # 기본 손절선 -1.2% (평균 손실 -2.06% → -1.2% 개선)

  # 초기 실패 컷 (NEW) - 손실 거래 보유시간 44.4분 → 15분 이하로 단축
  early_failure:
    enabled: true
    window_minutes: 15        # 진입 후 15분 이내
    loss_cut_pct: -0.6       # -0.6% 이하면 빠른 정리

  # 계좌 단위 리스크
  max_intraday_loss_pct: 3.5  # 하루 -3.5% 넘으면 당일 거래 중단

# =========================================
# 부분 청산 설정 (데이터 기반 하향 조정)
# =========================================
partial_exit:
  enabled: true               # 활성화
  tiers:
    - profit_pct: 2.0         # 기존 1.0 → 2.0 (실제 도달 가능한 수치)
      exit_ratio: 0.3         # 30% 청산 (기존 30% 유지)
    - profit_pct: 4.0         # 기존 2.0 → 4.0
      exit_ratio: 0.3         # 30% 추가 청산 (총 60% 청산)
    # 나머지 40%는 트레일링 스탑으로 큰 수익 기대

# =========================================
# 트레일링 스탑 (전략의 중심축)
# =========================================
trailing_stop:
  activation_profit_pct: 1.5  # +1.5% 이상 시 트레일링 시작
  distance_pct: 0.8          # 최고가 대비 -0.8% 하락 시 청산
  min_lock_profit_pct: 0.5   # 최소 잠금 수익 +0.5% (본전 방어)

  # ATR 기반 동적 조정 (선택)
  use_atr_based: false
  atr_multiplier: 1.5

# =========================================
# VWAP 청산 조건 (단독 청산 권한 약화)
# =========================================
vwap_exit:
  profit_threshold_for_ignore: 1.5  # +1.5% 이상 수익 시 VWAP 무시
  multi_condition_required: true    # 2개 이상 동시 충족 필요

  # 다중 조건 체크
  conditions:
    vwap_signal_below: true   # VWAP 하향 돌파
    ema_fast_below: true      # EMA3 하향 이탈
    rsi_below: 45             # RSI < 45 (모멘텀 약화)

# =========================================
# 시간 기반 청산 (15:00 강제청산 71.4% → 30% 이하 목표)
# =========================================
time_based_exit:
  loss_breakeven_exit_time: "15:00:00"  # 손실/본전 포지션 15:00 정리
  loss_breakeven_threshold_pct: 0.3     # +0.3% 이하면 손실/본전으로 간주
  final_force_exit_time: "15:10:00"     # 모든 포지션 15:10 최종 청산

# =========================================
# 기존 트레일링 설정 (하위 호환성)
# =========================================
trailing:
  activation_pct: 1.3        # 트레일링 활성화 수익률 (%)
  ratio: 1.0                 # 트레일링 비율 (%)
  stop_loss_pct: 1.0         # 기본 손절 (%)
  emergency_stop_pct: 2.0    # 긴급 손절 (%)

  # 목표가 도달 후 강화된 트레일링
  use_profit_tier: false
  profit_tier_threshold: 3.0
  profit_tier_ratio: 0.5

  # ATR 기반 트레일링
  use_atr_based: false
  atr_multiplier: 1.5

# =========================================
# VWAP 설정
# =========================================
vwap:
  use_rolling: true          # true = 이동 VWAP, false = 누적 VWAP
  rolling_window: 20         # 이동 VWAP 윈도우 (봉 개수)

# =========================================
# 필터 설정
# =========================================
filters:
  # 추세 필터
  use_trend_filter: true
  trend_period: 20

  # 거래량 필터
  use_volume_filter: true
  volume_multiplier: 1.3

  # Williams %R 필터
  use_williams_r_filter: true
  williams_r_period: 14
  williams_r_long_ceiling: -30

  # VWAP 돌파 지속성 확인
  use_breakout_confirm: true
  breakout_confirm_candles: 1

  # 거래대금 필터
  use_volume_value_filter: false
  min_volume_value: 1000000000

  # 시장 모멘텀 필터
  use_market_momentum: false

  # 진입 조건 완화 옵션
  vwap_tolerance_pct: 0.3
  ma_tolerance_pct: 0.2
  vwap_cross_only: false

  # 일봉 추세 강도 필터
  use_daily_trend_filter: false
  use_ema_alignment: true
  use_rsi_filter: true
  rsi_threshold: 50.0

  # 변동성 필터
  use_volatility_filter: false
  min_atr_pct: 0.5
  max_atr_pct: 5.0

# =========================================
# 시간 필터
# =========================================
time_filter:
  use_time_filter: false
  market_open: "09:00"
  market_close: "15:20"
  avoid_early_minutes: 10
  avoid_late_minutes: 10

# =========================================
# 재진입 방지
# =========================================
re_entry:
  use_cooldown: false
  cooldown_minutes: 30

# =========================================
# 리스크 관리 (기존)
# =========================================
risk_management:
  initial_capital: 10000000
  daily_max_loss_pct: 2.0
  max_drawdown_pct: 10.0
  max_trades_per_day: 5
  max_consecutive_losses: 3
  position_risk_pct: 1.0
  min_rr_ratio: 1.5

# =========================================
# 로깅 설정
# =========================================
logging:
  enabled: true
  log_dir: "logs"
  log_level: "INFO"

# =========================================
# 테스트 설정
# =========================================
test:
  stock_symbols:
    - "005930"  # 삼성전자
    - "015760"  # 한국전력
  data_days: 7
  interval: "5m"
