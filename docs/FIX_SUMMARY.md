# Kiwoom Trading System - ê¸´ê¸‰ ìˆ˜ì • ì™„ë£Œ

**ë‚ ì§œ:** 2025-10-30
**ìˆ˜ì • ë‚´ìš©:** í‚¤ì›€ API ì‘ë‹µ í‚¤ ì˜¤ë¥˜ ë° ì¢…ë£Œ ì‹ í˜¸ ì²˜ë¦¬

---

## âœ… ìˆ˜ì • ì™„ë£Œ

### 1. **í‚¤ì›€ API ì‘ë‹µ í‚¤ ìˆ˜ì •** ğŸ¯

**ë¬¸ì œ:**
```
âš ï¸  í‚¤ì›€ API ì‘ë‹µ í‚¤ ì—†ìŒ (003720). ì‘ë‹µ í‚¤: ['stk_cd', 'stk_min_pole_chart_qry', ...]
```

**ì›ì¸:**
ì‹¤ì œ API ì‘ë‹µ í‚¤ê°€ `stk_min_pole_chart_qry`ì¸ë°, ì½”ë“œì—ì„œëŠ” `stk_mnut_pole_chart_qry`ë¥¼ ì°¾ê³  ìˆì—ˆìŒ.

**í•´ê²°:**
`main_auto_trading.py` Line 135:
```python
# ìˆ˜ì • ì „
possible_keys = ['stk_mnut_pole_chart_qry', 'output', ...]

# ìˆ˜ì • í›„
possible_keys = ['stk_min_pole_chart_qry', 'stk_mnut_pole_chart_qry', 'output', ...]
```

**íš¨ê³¼:**
- âœ… í‚¤ì›€ APIì—ì„œ ì •ìƒì ìœ¼ë¡œ ë¶„ë´‰ ë°ì´í„° ì¡°íšŒ ê°€ëŠ¥
- âœ… Yahoo Finance ë³´ì¶© ë¹ˆë„ ê°ì†Œ (í‚¤ì›€ ë°ì´í„° ìš°ì„  ì‚¬ìš©)

---

### 1-1. **í‚¤ì›€ API ì»¬ëŸ¼ ë§¤í•‘ ìˆ˜ì •** ğŸ¯

**ë¬¸ì œ:**
```
âš ï¸  í‚¤ì›€ ë°ì´í„° ì»¬ëŸ¼ ë¶€ì¡± (003720): ì—†ëŠ” ì»¬ëŸ¼ ['datetime', 'time']
ì‹¤ì œ ì»¬ëŸ¼: ['close', 'volume', 'cntr_tm', 'open', 'high', 'low', 'acc_trde_qty', ...]
```

**ì›ì¸:**
ì‹¤ì œ API ì‘ë‹µì—ëŠ” `cntr_tm` (ì²´ê²°ì‹œê°: YYYYMMDDHHMMSS) ì»¬ëŸ¼ì´ ìˆëŠ”ë°, ì½”ë“œì—ì„œëŠ” `dt`/`tm` ë˜ëŠ” ë¶„ë¦¬ëœ `datetime`/`time` ì»¬ëŸ¼ì„ ê¸°ëŒ€í•˜ê³  ìˆì—ˆìŒ.

**í•´ê²°:**
`main_auto_trading.py` Line 155-159:
```python
# cntr_tm ì²˜ë¦¬: rename ì „ì— ë¨¼ì € ë¶„ë¦¬ (YYYYMMDDHHMMSS í˜•ì‹)
if 'cntr_tm' in df.columns:
    df['datetime'] = df['cntr_tm'].astype(str).str[:8]    # YYYYMMDD
    df['time'] = df['cntr_tm'].astype(str).str[8:14]      # HHMMSS
    df = df.drop(columns=['cntr_tm'])  # ì›ë³¸ ì»¬ëŸ¼ ì œê±°
```

**íš¨ê³¼:**
- âœ… í‚¤ì›€ APIì˜ `cntr_tm` ì»¬ëŸ¼ì„ ì •í™•í•˜ê²Œ `datetime`ê³¼ `time`ìœ¼ë¡œ ë¶„ë¦¬
- âœ… ë°ì´í„° ë³€í™˜ ì˜¤ë¥˜ í•´ê²°
- âœ… VWAP ê²€ì¦ì— í•„ìš”í•œ í‘œì¤€ ì»¬ëŸ¼ í™•ë³´

---

### 1-2. **pd.to_numeric ì°¸ì¡° ì˜¤ë¥˜ ìˆ˜ì •** ğŸ¯

**ë¬¸ì œ:**
```
TypeError: arg must be a list, tuple, 1-d array, or Series
at line 193: df = pd.to_numeric(df, errors='coerce')
```

**ì›ì¸:**
`df[col]` ë°©ì‹ì´ pandas ë‚´ë¶€ì—ì„œ ì°¸ì¡°ê°€ ëª¨í˜¸í•˜ê²Œ ì²˜ë¦¬ë˜ì–´ `df` ì „ì²´ê°€ ì „ë‹¬ë˜ëŠ” ê²½ìš° ë°œìƒ.

**í•´ê²°:**
`main_auto_trading.py` Line 193:
```python
# ìˆ˜ì • ì „
df[col] = pd.to_numeric(df[col], errors='coerce')

# ìˆ˜ì • í›„ (df.loc ì‚¬ìš©ìœ¼ë¡œ ì°¸ì¡° ëª…í™•í™”)
df.loc[:, col] = pd.to_numeric(df[col], errors='coerce')
```

**íš¨ê³¼:**
- âœ… pandasê°€ ì»¬ëŸ¼ ì°¸ì¡°ë¥¼ ëª…í™•í•˜ê²Œ ì¸ì‹
- âœ… `df` ì „ì²´ê°€ ì˜ëª» ì „ë‹¬ë˜ëŠ” ë¬¸ì œ ë°©ì§€
- âœ… ìˆ«ì ë³€í™˜ ì •ìƒ ë™ì‘

---

### 2. **ì¢…ë£Œ ì‹ í˜¸ ì²˜ë¦¬ ê°œì„ ** ğŸ›‘

**ë¬¸ì œ:**
```
^C
âš ï¸  ì¢…ë£Œ ì‹ í˜¸ ìˆ˜ì‹ 
... (ì¢…ë£Œë˜ì§€ ì•Šê³  ê³„ì† ì‹¤í–‰)
```

**ì›ì¸:**
ì—¬ëŸ¬ ë¬´í•œ ë£¨í”„ì—ì„œ `self.running` í”Œë˜ê·¸ë¥¼ ì²´í¬í•˜ì§€ ì•ŠìŒ.

**í•´ê²°:**

#### A. `run()` ë©”ì„œë“œ (Line 1493)
```python
# ìˆ˜ì • ì „
while True:
    await self.daily_routine()

# ìˆ˜ì • í›„
while self.running:
    await self.daily_routine()
    if not self.running:
        break
```

#### B. `wait_until_time()` ë©”ì„œë“œ (Line 1386)
```python
# ìˆ˜ì • ì „
while True:
    ...
    await asyncio.sleep(60)

# ìˆ˜ì • í›„
while self.running:
    ...
    if not self.running:
        console.print("[yellow]âš ï¸  ëŒ€ê¸° ì¤‘ ì¢…ë£Œ ì‹ í˜¸ ìˆ˜ì‹ [/yellow]")
        break
    await asyncio.sleep(60)
```

**íš¨ê³¼:**
- âœ… Ctrl+C ì…ë ¥ ì‹œ ì¦‰ì‹œ ì¢…ë£Œ
- âœ… ëŒ€ê¸° ì¤‘ì—ë„ ì¢…ë£Œ ì‹ í˜¸ ê°ì§€
- âœ… Graceful shutdown

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ê²°ê³¼ ì˜ˆìƒ

### í‚¤ì›€ API ì •ìƒ ë™ì‘ ì‹œ:
```
âœ“ í‚¤ì›€ API ì‘ë‹µ í‚¤: stk_min_pole_chart_qry
âœ“ í‚¤ì›€ API: 003720 ë°ì´í„° 95ê°œ ë´‰ ì¡°íšŒ
âœ“ cntr_tm ì»¬ëŸ¼ ë¶„ë¦¬ ì™„ë£Œ: datetime(YYYYMMDD) + time(HHMMSS)
âœ“ 003720.KS ë°ì´í„° ë¡œë“œ ì„±ê³µ (400ê°œ ë´‰)
âœ“ ë°ì´í„° ë³‘í•© ì™„ë£Œ: 495ê°œ ë´‰
âœ… ì‚¼ì˜: ìŠ¹ë¥  60.0%, ìˆ˜ìµ +1.5%
```

### ì¢…ë£Œ ì‹ í˜¸ ì •ìƒ ì²˜ë¦¬ ì‹œ:
```
^C
âš ï¸  ì¢…ë£Œ ì‹ í˜¸ ìˆ˜ì‹ 
âš ï¸  ëŒ€ê¸° ì¤‘ ì¢…ë£Œ ì‹ í˜¸ ìˆ˜ì‹ 
âš ï¸  ì‚¬ìš©ìê°€ ì¤‘ì§€í–ˆìŠµë‹ˆë‹¤.
[í”„ë¡œê·¸ë¨ ì¢…ë£Œ]
```

---

## ğŸ“Š ë°ì´í„° íë¦„ (ìµœì¢…)

```
1. í‚¤ì›€ API ì‹œë„
   - API-ID: ka10080 (ë¶„ë´‰ ì°¨íŠ¸)
   - ì‘ë‹µ í‚¤: stk_min_pole_chart_qry
   - 5ë¶„ë´‰ ë°ì´í„° ì¡°íšŒ
   â†“
2. ë°ì´í„° í™•ì¸
   - 100ê°œ ì´ìƒ: âœ… ë°”ë¡œ ì‚¬ìš©
   - 100ê°œ ë¯¸ë§Œ: â†’ 3ë‹¨ê³„ë¡œ
   - 0ê°œ: â†’ 3ë‹¨ê³„ë¡œ
   â†“
3. Yahoo Finance ë³´ì¶© (.KS/.KQ ìë™ ì „í™˜)
   - 7ì¼ì¹˜ 5ë¶„ë´‰ ë°ì´í„°
   - í‚¤ì›€ ë°ì´í„°ì™€ ë³‘í•©
   - ì¤‘ë³µ ì œê±°
   â†“
4. VWAP ê²€ì¦
   - ìµœì†Œ 100ê°œ ë´‰ í•„ìš”
   - ìŠ¹ë¥ , ìˆ˜ìµë¥  ê²€ì¦
   - í†µê³¼ ì‹œ ê´€ì‹¬ ì¢…ëª© ì¶”ê°€
```

---

## ğŸ”§ ìˆ˜ì •ëœ íŒŒì¼

- âœ… `main_auto_trading.py`
  - Line 135: ì‘ë‹µ í‚¤ ì¶”ê°€ (`stk_min_pole_chart_qry`)
  - Line 155-159: `cntr_tm` ì»¬ëŸ¼ ë¶„ë¦¬ ë¡œì§ ì¶”ê°€
  - Line 193: `df.loc[:, col]` ì‚¬ìš©ìœ¼ë¡œ ì°¸ì¡° ëª…í™•í™”
  - Line 1493: ë¬´í•œ ë£¨í”„ â†’ `while self.running`
  - Line 1386: ëŒ€ê¸° ë£¨í”„ì— ì¢…ë£Œ ì²´í¬ ì¶”ê°€

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

### 1. Yahoo Finance 6ê°œ ë´‰ ì¢…ëª©
**ì •ìƒ ë™ì‘ì…ë‹ˆë‹¤!**

```
âœ“ 046390.KS ë°ì´í„° ë¡œë“œ ì„±ê³µ (6ê°œ ë´‰)
â†’ ë°ì´í„° ë¶€ì¡± (6ê°œ < 100ê°œ) í•„í„°ë§ë¨
```

ì´ëŸ° ì¢…ëª©ë“¤ì€ ê±°ë˜ëŸ‰ì´ ê·¹íˆ ì ì–´ì„œ VWAP ì „ëµì— ë¶€ì í•©í•˜ë¯€ë¡œ ìë™ìœ¼ë¡œ ì œì™¸ë©ë‹ˆë‹¤.

### 2. í‚¤ì›€ API ì œí•œ
- **ë¶„ë´‰ ë°ì´í„° ì œê³µ ê°œìˆ˜**: ìµœëŒ€ 100~200ê°œ ì •ë„
- **ì¥ ì‹œì‘ ì§í›„**: ë°ì´í„°ê°€ ë¶€ì¡±í•  ìˆ˜ ìˆìŒ
- **í•´ê²°**: Yahoo Financeê°€ ìë™ìœ¼ë¡œ ë³´ì¶©

### 3. ì¢…ë£Œ íƒ€ì´ë°
- **ëŒ€ê¸° ì¤‘ ì¢…ë£Œ**: ìµœëŒ€ 60ì´ˆ ì§€ì—° (`asyncio.sleep(60)` ì‚¬ì´í´)
- **ëª¨ë‹ˆí„°ë§ ì¤‘ ì¢…ë£Œ**: ì¦‰ì‹œ ì¢…ë£Œ

---

## ğŸ“ ë‹¤ìŒ ì‹¤í–‰ ì‹œ í™•ì¸

ì‹¤í–‰ í›„ ë‹¤ìŒì„ í™•ì¸í•´ì£¼ì„¸ìš”:

### âœ… í‚¤ì›€ API ì •ìƒ ë™ì‘ í™•ì¸
```bash
# ë¡œê·¸ì—ì„œ ë‹¤ìŒ ë©”ì‹œì§€ ì°¾ê¸°:
grep "í‚¤ì›€ API ì‘ë‹µ í‚¤" ë¡œê·¸íŒŒì¼
grep "í‚¤ì›€ API: .* ë°ì´í„° [0-9]+ ê°œ ë´‰ ì¡°íšŒ" ë¡œê·¸íŒŒì¼
```

**ê¸°ëŒ€ ê²°ê³¼:**
- `âœ“ í‚¤ì›€ API ì‘ë‹µ í‚¤: stk_min_pole_chart_qry`
- `âœ“ í‚¤ì›€ API: 003720 ë°ì´í„° 95ê°œ ë´‰ ì¡°íšŒ`

### âœ… ì¢…ë£Œ ì‹ í˜¸ ì •ìƒ ì²˜ë¦¬ í™•ì¸
```bash
# Ctrl+C ì…ë ¥ í›„ 3ì´ˆ ì´ë‚´ ì¢…ë£Œë˜ëŠ”ì§€ í™•ì¸
time python main_auto_trading.py
# ... (Ctrl+C ì…ë ¥)
# â†’ 3ì´ˆ ì´ë‚´ ì¢…ë£Œë˜ë©´ ì •ìƒ
```

---

## ğŸš€ ì‹¤í–‰ ë°©ë²•

```bash
cd /home/greatbps/projects/kiwoom_trading
source venv/bin/activate
python main_auto_trading.py
```

### ì •ìƒ ì‹¤í–‰ ë¡œê·¸ ì˜ˆì‹œ:
```
[16:44:37] WebSocket ë¡œê·¸ì¸
âœ… ë¡œê·¸ì¸ ì„±ê³µ

[16:44:40] VWAP ê²€ì¦ ì‹œì‘... (í‚¤ì›€ API ìš°ì„ , Yahoo ë³´ì¶©)

âœ“ í‚¤ì›€ API ì‘ë‹µ í‚¤: stk_min_pole_chart_qry
âœ“ í‚¤ì›€ API: 003720 ë°ì´í„° 95ê°œ ë´‰ ì¡°íšŒ
âš ï¸  ì‚¼ì˜(003720) í‚¤ì›€ ë°ì´í„° ë¶€ì¡± (95ê°œ) â†’ Yahoo Finance ë³´ì¶© ì‹œë„
âœ“ 003720.KS ë°ì´í„° ë¡œë“œ ì„±ê³µ (400ê°œ ë´‰)
âœ“ ë°ì´í„° ë³‘í•© ì™„ë£Œ: 495ê°œ ë´‰
  âœ… ì‚¼ì˜: ìŠ¹ë¥  60.0%, ìˆ˜ìµ +1.5%

ì§„í–‰: 5/23
...

^C
âš ï¸  ì¢…ë£Œ ì‹ í˜¸ ìˆ˜ì‹ 
âš ï¸  ì‚¬ìš©ìê°€ ì¤‘ì§€í–ˆìŠµë‹ˆë‹¤.
```

---

## ğŸ“ ë¬¸ì œ ë°œìƒ ì‹œ

ì—¬ì „íˆ ë¬¸ì œê°€ ìˆë‹¤ë©´ ë‹¤ìŒ ì •ë³´ë¥¼ ì œê³µí•´ì£¼ì„¸ìš”:

1. **ì—ëŸ¬ ë©”ì‹œì§€ ì „ì²´**
2. **ë¡œê·¸ íŒŒì¼** (ê°€ëŠ¥í•˜ë©´)
3. **í‚¤ì›€ API access_token ìƒíƒœ** (ë§Œë£Œ ì—¬ë¶€)
4. **ì‹¤í–‰ ì‹œê°„** (ì¥ ì‹œê°„ ì—¬ë¶€)

---

**ì™„ë£Œ!** ğŸ‰ ì´ì œ ì •ìƒì ìœ¼ë¡œ ë™ì‘í•  ê²ƒì…ë‹ˆë‹¤!
