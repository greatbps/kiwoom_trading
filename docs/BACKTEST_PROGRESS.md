# ë°±í…ŒìŠ¤íŠ¸ í†µí•© ì§„í–‰ ìƒí™©

## âœ… ì™„ë£Œëœ ì‘ì—… (2025-11-02)

### 1. **ë°±í…ŒìŠ¤íŠ¸ ì‹œìŠ¤í…œ êµ¬í˜„** (`backtest_with_ranker.py`)
- [x] ì‹œë®¬ë ˆì´ì…˜ ë¡œì§ (ìµì ˆ/ì†ì ˆ/ë³´ìœ ê¸°ê°„)
- [x] entry_features ìˆ˜ì§‘ (8ê°œ í”¼ì²˜)
- [x] JSON ê²°ê³¼ ì €ì¥ (Ranker í•™ìŠµ ë°ì´í„° í¬ë§·)
- [x] **ì‹¤ì œ í‚¤ì›€ API ë°ì´í„° ì§€ì›** (`use_real_data=True`)
- [x] Mock ë°ì´í„° í´ë°± (ë°ì´í„° ë¶€ì¡±/ì—ëŸ¬ ì‹œ ìë™)

### 2. **ë©”ë‰´ í†µí•©** (`main_menu.py` ì˜µì…˜ [5])
- [x] ë°±í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¸í„°í˜ì´ìŠ¤
- [x] íŒŒë¼ë¯¸í„° ì…ë ¥ (ë³´ìœ ê¸°ê°„, ìµì ˆ, ì†ì ˆ)
- [x] ê²°ê³¼ ì¶œë ¥ ë° ì €ì¥

### 3. **í‚¤ì›€ REST API í™•ì¥** (`core/kiwoom_rest_client.py`)
- [x] `get_daily_chart()`: ì¼ë´‰ ì°¨íŠ¸ ì¡°íšŒ (API ID: ka10081)
- [x] `get_historical_data_for_backtest()`: ë°±í…ŒìŠ¤íŠ¸ìš© ê³¼ê±° ë°ì´í„° ì¡°íšŒ
- [x] ì¼ë´‰/ë¶„ë´‰ ìë™ ì„ íƒ ë° ê¸°ê°„ í•„í„°ë§
- [x] Rate limit ì²˜ë¦¬ ë° ì—ëŸ¬ í•¸ë“¤ë§

### 4. **ì¡°ê±´ê²€ìƒ‰ â†’ ë°±í…ŒìŠ¤íŠ¸ í†µí•©**
- [x] `utils/backtest_integration.py`: VWAP ê²°ê³¼ â†’ ë°±í…ŒìŠ¤íŠ¸ DataFrame ë³€í™˜
- [x] `run_condition_and_backtest.py`: í†µí•© ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸
- [x] ì¡°ê±´ê²€ìƒ‰ â†’ VWAP í•„í„° â†’ ë°±í…ŒìŠ¤íŠ¸ â†’ ê²°ê³¼ ì €ì¥ ì „ì²´ íŒŒì´í”„ë¼ì¸

---

## ğŸ¯ ì‚¬ìš© ë°©ë²•

### ë°©ë²• 1: í†µí•© íŒŒì´í”„ë¼ì¸ ì‹¤í–‰ (ê¶Œì¥)

```bash
python run_condition_and_backtest.py
```

**í”Œë¡œìš°:**
1. ì¡°ê±´ê²€ìƒ‰ ì‹¤í–‰ (Momentum, Breakout, EOD ë“±)
2. VWAP 2ì°¨ í•„í„°ë§
3. ë°±í…ŒìŠ¤íŠ¸ (ì‹¤ì œ ë°ì´í„° or Mock ì„ íƒ ê°€ëŠ¥)
4. ê²°ê³¼ ì €ì¥ â†’ `./backtest_results/`

### ë°©ë²• 2: ë©”ë‰´ì—ì„œ ë°±í…ŒìŠ¤íŠ¸ë§Œ ì‹¤í–‰

```bash
./run.sh
# ë©”ë‰´ì—ì„œ [5] ë°±í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì„ íƒ
```

**í˜„ì¬:** ìƒ˜í”Œ ë°ì´í„°ë¡œ í…ŒìŠ¤íŠ¸
**í–¥í›„:** ì¡°ê±´ê²€ìƒ‰ ê²°ê³¼ ìë™ ì—°ë™ ì˜ˆì •

### ë°©ë²• 3: í”„ë¡œê·¸ë¨ì—ì„œ ì§ì ‘ ì‚¬ìš©

```python
from backtest_with_ranker import BacktestRunner
from core.kiwoom_rest_client import KiwoomRESTClient
import pandas as pd

# API í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™” (ì‹¤ì œ ë°ì´í„° ì‚¬ìš© ì‹œ)
async with KiwoomRESTClient(app_key, app_secret) as api_client:
    # ë°±í…ŒìŠ¤íŠ¸ ì‹¤í–‰
    runner = BacktestRunner(
        use_real_data=True,  # ì‹¤ì œ ë°ì´í„° ì‚¬ìš©
        api_client=api_client
    )

    results = await runner.run_backtest(
        candidates_df,
        holding_period=5,
        take_profit_pct=3.0,
        stop_loss_pct=-2.0
    )

    runner.display_results(results)
```

---

## ğŸš€ ë‹¤ìŒ ë‹¨ê³„

### ìš°ì„ ìˆœìœ„ 1: Feature ì‹¤ì‹œê°„ ê³„ì‚° ë¡œì§ êµ¬í˜„

**í˜„ì¬ ë¬¸ì œ:**
`utils/backtest_integration.py`ì—ì„œ ì„ì‹œê°’ ì‚¬ìš©:
```python
entry_price = 10000  # ì„ì‹œê°’
volume = 1000000  # ì„ì‹œê°’
recent_return_5d = 0.0  # ì„ì‹œê°’
```

**í•„ìš” ì‘ì—…:**
- í˜„ì¬ê°€ ì¡°íšŒ API í†µí•©
- ê±°ë˜ëŸ‰ í†µê³„ ê³„ì‚° (20ì¼ í‰ê· /í‘œì¤€í¸ì°¨)
- ìµœê·¼ ìˆ˜ìµë¥  ê³„ì‚° (5ì¼)
- ì‹œì¥ ë³€ë™ì„± ê³„ì‚° (KOSPI ATR)
- ì—…ì¢… ê°•ë„/ê°€ê²© ëª¨ë©˜í…€ ê³„ì‚°

### ìš°ì„ ìˆœìœ„ 2: ëŒ€ëŸ‰ ë°±í…ŒìŠ¤íŠ¸ ì‹¤í–‰ (100+ ìƒ˜í”Œ ìˆ˜ì§‘)

**ëª©í‘œ:** Ranker ì‹¤ì „ í•™ìŠµìš© ë°ì´í„° í™•ë³´

**ë°©ë²•:**
- ë§¤ì¼ ì¡°ê±´ê²€ìƒ‰ ê²°ê³¼ë¥¼ ê¸°ë¡
- 30-60ì¼ ëˆ„ì  â†’ 100+ ê±°ë˜ ìƒ˜í”Œ
- ë˜ëŠ” ê³¼ê±° ë°ì´í„°ë¡œ ì‹œë®¬ë ˆì´ì…˜ (ì—­ì‚¬ì  ì¡°ê±´ê²€ìƒ‰ ì¬í˜„)

### ìš°ì„ ìˆœìœ„ 3: í‚¤ì›€ API ì¼ë´‰ ì‘ë‹µ í•„ë“œëª… í™•ì¸

**í˜„ì¬ ì½”ë“œ:**
```python
current_price = float(day_data.get('stk_close_prc', day_data.get('close', entry_price)))
```

**í•„ìš”:**
- ì‹¤ì œ í‚¤ì›€ API ì¼ë´‰ ì‘ë‹µ í™•ì¸
- í•„ë“œëª… ì •í™•íˆ ë§¤í•‘ (`stk_close_prc`, `stk_high_prc` ë“±)

### ìš°ì„ ìˆœìœ„ 4: ë©”ì¸ ìë™ë§¤ë§¤ì— Ranker í†µí•©

**ëª©í‘œ:**
```
ì¡°ê±´ê²€ìƒ‰ â†’ VWAP í•„í„° â†’ [Ranker ì ìˆ˜í™”] â†’ ìƒìœ„ Kê°œ ì„ ì • â†’ ëª¨ë‹ˆí„°ë§ â†’ ë§¤ë§¤
```

**í•„ìš” ì‘ì—…:**
- `main_auto_trading.py` ìˆ˜ì •
- Ranker ë¡œë“œ ë° ì˜ˆì¸¡
- `threshold=0.7`, `top_k=10` ì ìš©

---

## ğŸ“Š í˜„ì¬ ìƒíƒœ ìš”ì•½

| í•­ëª© | ìƒíƒœ | ë¹„ê³  |
|------|------|------|
| ë°±í…ŒìŠ¤íŠ¸ ì‹œë®¬ë ˆì´ì…˜ ë¡œì§ | âœ… ì™„ë£Œ | ìµì ˆ/ì†ì ˆ/ë³´ìœ ê¸°ê°„ |
| ì‹¤ì œ ë°ì´í„° ì§€ì› | âœ… ì™„ë£Œ | í‚¤ì›€ API ì¼ë´‰/ë¶„ë´‰ |
| Mock ë°ì´í„° í´ë°± | âœ… ì™„ë£Œ | ìë™ ì „í™˜ |
| ì¡°ê±´ê²€ìƒ‰ ì—°ë™ | âœ… ì™„ë£Œ | í†µí•© ìŠ¤í¬ë¦½íŠ¸ |
| Entry Features ìˆ˜ì§‘ | âš ï¸ ì„ì‹œê°’ | ì‹¤ì‹œê°„ ê³„ì‚° í•„ìš” |
| ëŒ€ëŸ‰ ë°ì´í„° ìˆ˜ì§‘ | âŒ ë¯¸ì™„ë£Œ | 100+ ìƒ˜í”Œ í•„ìš” |
| Ranker íŒŒì´í”„ë¼ì¸ í†µí•© | âŒ ë¯¸ì™„ë£Œ | main_auto_trading.py |

---

## ğŸ“ ê´€ë ¨ íŒŒì¼

- `backtest_with_ranker.py` - ë°±í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì—”ì§„
- `core/kiwoom_rest_client.py` - í‚¤ì›€ API í´ë¼ì´ì–¸íŠ¸
- `utils/backtest_integration.py` - ë°ì´í„° ë³€í™˜ ìœ í‹¸
- `run_condition_and_backtest.py` - í†µí•© ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸
- `main_menu.py` - ë©”ë‰´ ì˜µì…˜ [5]
- `ml/candidate_ranker.py` - Ranker ëª¨ë¸
- `ml/training_data_builder.py` - í•™ìŠµ ë°ì´í„° ë¹Œë”

---

**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸:** 2025-11-02
**ì‘ì„±ì:** Claude Code
