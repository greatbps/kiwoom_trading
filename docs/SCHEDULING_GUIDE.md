# 자동 스케줄링 가이드

**작성일:** 2025-10-26 16:00
**버전:** v2.0 (스케줄링 모드)

---

## 🚀 지금 실행하면?

### 현재 시간: 일요일 오후
```
지금 실행 → 내일 월요일 08:50까지 대기 → 필터링 시작 → 09:00 모니터링
```

### 실행 명령
```bash
cd /home/greatbps/projects/kiwoom_trading
./run.sh
```

---

## ⏰ 자동 스케줄

### 매일 반복 사이클
```
08:50 ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 15:30
  ↓                                           ↓
필터링 시작                              장 마감 → 내일 08:50까지 대기
  ↓
  ├─ 1차 필터링: 조건식 검색
  ├─ 2차 필터링: VWAP, 거래량, ADX 검증
  └─ 종목 선정 완료

09:00 ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 15:30
  ↓                                           ↓
모니터링 시작                            자동 종료
  ↓
  ├─ 10초마다 현재가 조회
  ├─ 매수/매도 신호 체크
  └─ 자동 거래 실행
```

---

## 📅 예상 스케줄 (테스트 결과)

**현재:** 2025-10-26 15:59 (일요일)

### 이번 주
```
📍 지금 실행 시
  ↓
⏰ 2025-10-27 08:50 (월요일) - 필터링 시작
  - 계좌 정보 조회
  - 조건식 검색
  - VWAP 필터링
  ↓
⏰ 2025-10-27 09:00 (월요일) - 모니터링 시작
  - 실시간 가격 추적
  - 자동 매매 실행
  ↓
⏰ 2025-10-27 15:30 (월요일) - 거래 종료
  - 다음날 08:50까지 대기
  ↓
⏰ 2025-10-28 08:50 (화요일) - 필터링 시작
  ... (반복)
```

---

## 🔄 주말 처리

**토요일/일요일에 실행하면:**
```
현재 주말입니다!
└─> 다음 월요일 08:50까지 대기 (16시간 50분)
```

**금요일 15:30 이후:**
```
오늘 거래 종료
└─> 다음 월요일 08:50까지 대기
```

---

## 📊 화면 출력 예시

### 1. 프로그램 시작 (지금 실행)
```
========================================================
🚀 자동매매 시스템 시작 (스케줄링 모드)
========================================================

매일 08:50 필터링 → 09:00 모니터링 시작
Ctrl+C를 눌러 종료할 수 있습니다.


========================================================
📅 일일 자동매매 루틴 시작
========================================================

⏰ 주말입니다. 다음 월요일 08:50까지 대기...
   목표 시간: 2025-10-27 08:50:00
⏰ 08:50까지 대기 중... (남은 시간: 16시간 50분)
⏰ 08:50까지 대기 중... (남은 시간: 16시간 49분)
...
```

### 2. 월요일 08:50 도달
```
✓ 08:50 도달!

[1단계] 시스템 초기화
  - WebSocket 연결
  - 로그인
  - 계좌 정보 조회 (예수금: 425,654원)

[2단계] 필터링 시작 (08:50)
  🔍 조건식 검색 중...
  🔍 VWAP 필터링 중...
  ✓ 선정 완료: 5개 종목

⏰ 09:00까지 대기 중... (남은 시간: 0시간 9분)
```

### 3. 월요일 09:00 도달
```
✓ 09:00 도달!

[3단계] 실시간 모니터링 시작 (09:00)

========================================================
3단계: 실시간 모니터링 시작
========================================================

🎯 모니터링 대상: 5개 종목
⏰ 시작 시간: 2025-10-27 09:00:00

✅ 장이 열려있습니다. 실시간 모니터링 시작...

[09:00:10] 삼성전자(005930): 50,000원 | VWAP: 49,800원
[09:00:20] 삼성전자(005930): 50,100원 | VWAP: 49,850원
...
```

### 4. 15:30 거래 종료
```
⏰ 15:30 도달 - 거래 종료

✅ 오늘 거래 종료 (15:30)
💤 내일 08:50까지 대기합니다...

⏰ 08:50까지 대기 중... (남은 시간: 17시간 20분)
```

---

## 🎯 핵심 기능

### 1. 자동 시간 대기
- **08:50 대기**: 필터링 시작 시간
- **09:00 대기**: 모니터링 시작 시간
- **주말 대기**: 자동으로 다음 월요일까지

### 2. 무한 반복
- 매일 08:50에 자동 시작
- 15:30에 자동 종료
- 다음날까지 대기

### 3. 에러 복구
- 오류 발생 시 1분 후 재시도
- 종목 없으면 다음날 재시도

---

## ⚙️ 설정 변경 (필요시)

### 필터링 시간 변경
**파일:** `main_auto_trading.py:959`
```python
# 08:50 → 08:30으로 변경
await self.wait_until_time(8, 30)  # 기존: (8, 50)
```

### 모니터링 시작 시간 변경
**파일:** `main_auto_trading.py:989`
```python
# 09:00 → 09:10으로 변경
await self.wait_until_time(9, 10)  # 기존: (9, 0)
```

---

## 🚦 실행 모드

### 백그라운드 실행 (추천)
```bash
cd /home/greatbps/projects/kiwoom_trading

# nohup으로 백그라운드 실행
nohup ./run.sh > logs/auto_trading.log 2>&1 &

# 프로세스 확인
ps aux | grep main_auto_trading

# 로그 확인
tail -f logs/auto_trading.log
```

### 일반 실행 (터미널)
```bash
cd /home/greatbps/projects/kiwoom_trading
./run.sh

# Ctrl+C로 중지 가능
```

---

## 📝 로그 확인

### 실시간 로그 보기
```bash
tail -f logs/auto_trading.log
```

### 거래 내역 확인
```bash
# DB 조회
sqlite3 data/kiwoom_trading.db "SELECT * FROM trades ORDER BY trade_time DESC LIMIT 10;"
```

### 필터링 결과 확인
```bash
# 필터링 로그
sqlite3 data/kiwoom_trading.db "SELECT * FROM filter_results ORDER BY filter_time DESC LIMIT 10;"
```

---

## ✅ 체크리스트

### 실행 전 확인
- [ ] 키움증권 API 토큰 유효 (24시간)
- [ ] 계좌 정보 정상 (425,654원 확인됨)
- [ ] 조건식 설정 완료
- [ ] 리스크 관리 설정 확인

### 실행 중 모니터링
- [ ] 08:50에 필터링 시작 확인
- [ ] 09:00에 모니터링 시작 확인
- [ ] 거래 발생 시 알림 확인
- [ ] 15:30에 자동 종료 확인

### 일일 점검
- [ ] 거래 내역 확인
- [ ] 손익 확인
- [ ] 에러 로그 확인
- [ ] 다음날 스케줄 확인

---

## 🎉 완료!

**실행 명령:**
```bash
cd /home/greatbps/projects/kiwoom_trading
./run.sh
```

**예상 동작:**
```
지금 실행 (일요일 16:00)
  ↓
내일 08:50까지 대기 (16시간 50분)
  ↓
월요일 08:50 - 필터링 시작
  ↓
월요일 09:00 - 모니터링 시작
  ↓
월요일 15:30 - 거래 종료
  ↓
화요일 08:50까지 대기
  ↓
(무한 반복)
```

---

**작성:** 2025-10-26 16:00
**테스트 완료:** ✅
**실전 준비:** 🟢 완료
