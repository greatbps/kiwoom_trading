# Bottom Pullback ì „ëµ ìƒì„¸ ë¬¸ì„œ

**ì „ëµ ì½”ë“œ**: ì¡°ê±´ 23ë²ˆ
**êµ¬í˜„ì¼**: 2025-12-23
**ì „ëµ íƒœê·¸**: `bottom_pullback`

---

## 1. ì „ëµ ê°œìš”

### í•µì‹¬ ì•„ì´ë””ì–´

**"ì €ì  í™•ì¸ í›„ ì¬ëŒíŒŒ ì‹œ ì§„ì…"**

ê¸°ì¡´ Momentum ì „ëµ(17-22ë²ˆ)ê³¼ ë‹¬ë¦¬, ì¡°ê±´ê²€ìƒ‰ ì‹ í˜¸ê°€ ë°œìƒí•´ë„ ì¦‰ì‹œ ë§¤ìˆ˜í•˜ì§€ ì•Šê³ :
1. VWAP ì´íƒˆ (Pullback) ëŒ€ê¸°
2. ì‹ í˜¸ë´‰ ì €ê°€ ì§€ì§€ í™•ì¸
3. VWAP ì¬ëŒíŒŒ + ê±°ë˜ëŸ‰ í™•ì¸
4. ì¡°ê±´ ì¶©ì¡± ì‹œì—ë§Œ ë§¤ìˆ˜

### ì°¨ë³„ì 

| êµ¬ë¶„ | Momentum (17-22) | Bottom Pullback (23) |
|------|------------------|----------------------|
| ì§„ì… ë°©ì‹ | ì¦‰ì‹œ ë§¤ìˆ˜ | ëŒ€ê¸° í›„ ë§¤ìˆ˜ |
| ì‹ í˜¸ ì²˜ë¦¬ | watchlist | signal_watchlist |
| VWAP ì¡°ê±´ | ìƒë‹¨ ìœ ì§€ | ì´íƒˆ â†’ ì¬ëŒíŒŒ |
| ë¦¬ìŠ¤í¬ | ë†’ìŒ (ì¶”ê²©) | ë‚®ìŒ (ì§€ì§€ í™•ì¸) |
| ìˆ˜ìµë¥  | ë¹ ë¥¸ ìˆ˜ìµ ê¸°ëŒ€ | ì•ˆì •ì  ì§„ì… |

---

## 2. ìƒíƒœ ë¨¸ì‹  (State Machine)

### 2.1 ìƒíƒœ ì „ì´ë„

```
  [ì¡°ê±´ ì‹ í˜¸ ë°œìƒ]
         â†“
   WAIT_PULLBACK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    (ì‹ í˜¸ ëŒ€ê¸°)                             â”‚
         â”‚                                  â”‚
         â”‚ VWAP ì´íƒˆ ê°ì§€                   â”‚
         â†“                                  â”‚ ë¬´íš¨í™”:
 PULLBACK_DETECTED                          â”‚ - ì €ê°€ ì´íƒˆ
  (Pullback í™•ì¸)                           â”‚ - ì‹œê°„ ì´ˆê³¼
         â”‚                                  â”‚ - ì‹œê°„ëŒ€ ì´íƒˆ
         â”‚ VWAP ì¬ëŒíŒŒ + ê±°ë˜ëŸ‰ OK           â”‚
         â†“                                  â”‚
  READY_TO_ENTER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   (ë§¤ìˆ˜ ì¤€ë¹„)                              â”‚
         â”‚                                  â”‚
         â”‚ ë§¤ìˆ˜ ì‹¤í–‰                         â”‚
         â†“                                  â†“
   IN_POSITION                        INVALIDATED
   (í¬ì§€ì…˜ ë³´ìœ )                        (ì‹ í˜¸ ë¬´íš¨)
```

### 2.2 ìƒíƒœ ì„¤ëª…

#### WAIT_PULLBACK
- **ì˜ë¯¸**: ì¡°ê±´ê²€ìƒ‰ ì‹ í˜¸ ë°œìƒ, VWAP Pullback ëŒ€ê¸° ì¤‘
- **ì¡°ê±´**:
  - ì¡°ê±´ 23ë²ˆ ì‹ í˜¸ ê°ì§€
  - L0-L6 í•„í„° í†µê³¼
  - ì‹ í˜¸ ì •ë³´ ë“±ë¡ (ê°€ê²©, ì €ê°€, VWAP)
- **ì „ì´**:
  - `current_price < current_vwap` â†’ PULLBACK_DETECTED
  - ë¬´íš¨í™” ì¡°ê±´ ì¶©ì¡± â†’ INVALIDATED

#### PULLBACK_DETECTED
- **ì˜ë¯¸**: VWAP ì´íƒˆ í™•ì¸, ì¬ëŒíŒŒ ëŒ€ê¸° ì¤‘
- **ì¡°ê±´**:
  - VWAP ì´íƒˆ ê°ì§€ë¨
  - ì‹ í˜¸ë´‰ ì €ê°€ ìœ ì§€ ì¤‘
- **ì „ì´**:
  - `current_price > current_vwap` AND `volume_ratio >= 1.0` â†’ READY_TO_ENTER
  - ë¬´íš¨í™” ì¡°ê±´ ì¶©ì¡± â†’ INVALIDATED

#### READY_TO_ENTER
- **ì˜ë¯¸**: Pullback ì™„ë£Œ, ë§¤ìˆ˜ ì¤€ë¹„ ì™„ë£Œ
- **ì¡°ê±´**:
  - VWAP ì¬ëŒíŒŒ í™•ì¸
  - ê±°ë˜ëŸ‰ ì¡°ê±´ ì¶©ì¡± (â‰¥ 1.0x)
  - ì‹ í˜¸ë´‰ ì €ê°€ ìœ ì§€ ì¤‘
- **ì „ì´**:
  - ë§¤ìˆ˜ ì‹¤í–‰ â†’ IN_POSITION

#### IN_POSITION
- **ì˜ë¯¸**: ë§¤ìˆ˜ ì™„ë£Œ, í¬ì§€ì…˜ ë³´ìœ  ì¤‘
- **ê´€ë¦¬**: ì¼ë°˜ í¬ì§€ì…˜ ê´€ë¦¬ (Trailing Stop, Partial Exit ë“±)

#### INVALIDATED
- **ì˜ë¯¸**: ì‹ í˜¸ ë¬´íš¨í™”, ì§„ì… ì·¨ì†Œ
- **ì›ì¸**:
  - ì‹ í˜¸ë´‰ ì €ê°€ -0.5% ì´íƒˆ
  - ëŒ€ê¸° ì‹œê°„ 180ë¶„ ì´ˆê³¼
  - ì§„ì… ì‹œê°„ëŒ€ ì´íƒˆ (09:30-14:30 ì™¸)

---

## 3. í•µì‹¬ ë¡œì§ êµ¬í˜„

### 3.1 ì‹ í˜¸ ë“±ë¡ (`register_signal`)

```python
def register_signal(
    stock_code: str,
    stock_name: str,
    signal_price: float,  # ì‹ í˜¸ ë°œìƒ ì‹œ í˜„ì¬ê°€
    signal_low: float,    # ì‹ í˜¸ë´‰ ì €ê°€
    signal_vwap: float,   # ì‹ í˜¸ ë°œìƒ ì‹œ VWAP
    market: str = "KOSDAQ"
) -> bool:
    """
    ì¡°ê±´ê²€ìƒ‰ ì‹ í˜¸ ë“±ë¡

    Returns:
        True: ì‹ í˜¸ ë“±ë¡ ì„±ê³µ
        False: ì¤‘ë³µ ì‹ í˜¸ (ê°™ì€ ë‚  ì´ë¯¸ ë“±ë¡)
    """
```

**ì¤‘ë³µ ë°©ì§€**:
- ê°™ì€ ì¢…ëª©, ê°™ì€ ë‚ ì§œ: 1íšŒë§Œ ë“±ë¡
- ë‚ ì§œ ë³€ê²½ ì‹œ ìë™ ë¦¬ì…‹

### 3.2 Pullback ì²´í¬ (`check_pullback`)

```python
def check_pullback(
    stock_code: str,
    current_price: float,
    current_vwap: float,
    current_low: float,
    recent_volume: float,
    avg_volume_5: float,
    df: pd.DataFrame = None
) -> Tuple[bool, str]:
    """
    Pullback ì¡°ê±´ ì²´í¬

    Returns:
        (ready_to_enter, reason)
        - ready_to_enter: Trueë©´ ë§¤ìˆ˜ ì‹ í˜¸ ë°œìƒ
        - reason: ìƒíƒœ ì„¤ëª…
    """
```

**ì²´í¬ ìˆœì„œ**:
1. âœ… ì‹ í˜¸ë´‰ ì €ê°€ ìœ ì§€ í™•ì¸
2. âœ… ì‹œê°„ ì œí•œ í™•ì¸ (180ë¶„)
3. âœ… ì§„ì… ì‹œê°„ëŒ€ í™•ì¸ (09:30-14:30)
4. âœ… VWAP ì´íƒˆ ê°ì§€
5. âœ… VWAP ì¬ëŒíŒŒ + ê±°ë˜ëŸ‰ í™•ì¸

---

## 4. ì„¤ì • ê°’ (config/strategy_hybrid.yaml)

### 4.1 ì „ëµ ì •ì˜

```yaml
condition_strategies:
  bottom_pullback:
    condition_indices: [23]           # ì¡°ê±´ 23ë²ˆ
    strategy_tag: "bottom_pullback"
    immediate_entry: false            # ì¦‰ì‹œ ë§¤ìˆ˜ X
    wait_for_pullback: true           # Pullback ëŒ€ê¸°
    max_entries_per_day: 1            # ì¼ì¼ 1íšŒ ì§„ì…
    description: "ì¡°ê±´ ì‹ í˜¸ â†’ VWAP Pullback ëŒ€ê¸° â†’ ì¬ëŒíŒŒ ì‹œ ì§„ì…"
```

### 4.2 Pullback ì¡°ê±´

```yaml
pullback:
  type: "vwap_reclaim"                # VWAP ì¬ëŒíŒŒ íƒ€ì…
  allow_below_vwap: true              # VWAP ì´íƒˆ í—ˆìš©
  invalidate_if_break_signal_low: true  # ì €ê°€ ì´íƒˆ ì‹œ ë¬´íš¨í™”

  # VWAP ì¬ëŒíŒŒ ì¡°ê±´
  reclaim_conditions:
    min_volume_ratio: 1.0             # ê±°ë˜ëŸ‰ â‰¥ 5ë´‰ í‰ê· 
    confirm_candles: 1                # í™•ì¸ ë´‰ ìˆ˜

  # ë¬´íš¨í™” ì¡°ê±´
  invalidation:
    break_signal_low_pct: -0.5        # ì €ê°€ -0.5% ì´íƒˆ ì‹œ ë¬´íš¨
    max_wait_minutes: 180             # ìµœëŒ€ ëŒ€ê¸° 3ì‹œê°„

  # ì‹œê°„ ì œí•œ
  time_window:
    start: "09:30"                    # ì§„ì… ê°€ëŠ¥ ì‹œì‘
    end: "14:30"                      # ì§„ì… ê°€ëŠ¥ ì¢…ë£Œ
```

---

## 5. ì‹¤ì „ ì˜ˆì‹œ

### ì˜ˆì‹œ 1: ì„±ê³µì ì¸ Pullback ì§„ì…

```
09:15  ì¡°ê±´ 23ë²ˆ ì‹ í˜¸ ë°œìƒ
       ì¢…ëª©: Aì‚¬
       ê°€ê²©: 10,000ì›
       VWAP: 9,950ì›
       ì €ê°€: 9,900ì›

       â†’ signal_watchlist ë“±ë¡
       â†’ ìƒíƒœ: WAIT_PULLBACK

09:30  í˜„ì¬ê°€: 9,920ì› (VWAP ì´íƒˆ!)
       VWAP: 9,950ì›

       â†’ ìƒíƒœ: PULLBACK_DETECTED
       â†’ "VWAP ì´íƒˆ ê°ì§€" ë¡œê·¸ ì¶œë ¥

09:45  í˜„ì¬ê°€: 9,980ì› (VWAP ì¬ëŒíŒŒ!)
       VWAP: 9,950ì›
       ê±°ë˜ëŸ‰: 5ë´‰ í‰ê· ì˜ 1.2ë°°
       ì €ê°€: 9,910ì› (ì‹ í˜¸ë´‰ ì €ê°€ 9,900ì› ìœ ì§€)

       â†’ ìƒíƒœ: READY_TO_ENTER
       â†’ ë§¤ìˆ˜ ì‹¤í–‰
       â†’ ìƒíƒœ: IN_POSITION
```

### ì˜ˆì‹œ 2: ì €ê°€ ì´íƒˆë¡œ ë¬´íš¨í™”

```
10:00  ì¡°ê±´ 23ë²ˆ ì‹ í˜¸ ë°œìƒ
       ì¢…ëª©: Bì‚¬
       ê°€ê²©: 5,000ì›
       VWAP: 4,980ì›
       ì €ê°€: 4,950ì›

       â†’ signal_watchlist ë“±ë¡
       â†’ ìƒíƒœ: WAIT_PULLBACK

10:15  í˜„ì¬ê°€: 4,920ì› (ì €ê°€ ê¸‰ë½!)
       ì €ê°€: 4,920ì›
       ë¬´íš¨í™” ê¸°ì¤€: 4,950 * (1 - 0.5%) = 4,925ì›

       â†’ 4,920 < 4,925 (ì €ê°€ ì´íƒˆ!)
       â†’ ìƒíƒœ: INVALIDATED
       â†’ "ì‹ í˜¸ë´‰ ì €ê°€ ì´íƒˆ" ë¡œê·¸ ì¶œë ¥
```

### ì˜ˆì‹œ 3: ì‹œê°„ ì´ˆê³¼ë¡œ ë¬´íš¨í™”

```
11:00  ì¡°ê±´ 23ë²ˆ ì‹ í˜¸ ë°œìƒ
       ì¢…ëª©: Cì‚¬

       â†’ signal_watchlist ë“±ë¡
       â†’ ìƒíƒœ: WAIT_PULLBACK

11:00 ~ 14:00
       VWAP ì´íƒˆ ì—†ìŒ
       ì‹ í˜¸ë´‰ ì €ê°€ ìœ ì§€

14:01  ê²½ê³¼ ì‹œê°„: 181ë¶„ (> 180ë¶„)

       â†’ ìƒíƒœ: INVALIDATED
       â†’ "ì‹œê°„ ì´ˆê³¼" ë¡œê·¸ ì¶œë ¥
```

---

## 6. ì½”ë“œ êµ¬ì¡°

### 6.1 íŒŒì¼ ìœ„ì¹˜

```
trading/
  â””â”€â”€ bottom_pullback_manager.py      # í•µì‹¬ êµ¬í˜„ íŒŒì¼
      â”œâ”€â”€ class BottomPullbackManager
      â”œâ”€â”€ __init__(config)
      â”œâ”€â”€ register_signal()
      â”œâ”€â”€ check_pullback()
      â”œâ”€â”€ mark_entered()
      â”œâ”€â”€ _invalidate_signal()
      â”œâ”€â”€ get_signal_watchlist()
      â”œâ”€â”€ reset_daily()
      â”œâ”€â”€ remove_signal()
      â””â”€â”€ get_signal_info()
```

### 6.2 main_auto_trading.py í†µí•©

```python
# ì´ˆê¸°í™”
self.bottom_manager = BottomPullbackManager(bottom_config)

# ì¡°ê±´ê²€ìƒ‰ ë¶„ê¸°
if idx in bottom_indices:
    # Bottom ì „ëµ: ì‹ í˜¸ ë“±ë¡
    self.bottom_manager.register_signal(...)
    self.validated_stocks[stock_code]['strategy'] = 'bottom_pullback'
else:
    # Momentum ì „ëµ: watchlist ì¶”ê°€
    self.watchlist.add(stock_code)
    self.validated_stocks[stock_code]['strategy'] = 'momentum'

# ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§
signal_watchlist = self.bottom_manager.get_signal_watchlist()
for stock_code, signal_info in signal_watchlist.items():
    ready, reason = self.bottom_manager.check_pullback(...)
    if ready:
        await self.check_entry_signal(stock_code)
        self.bottom_manager.mark_entered(stock_code)
```

---

## 7. ëª¨ë‹ˆí„°ë§

### 7.1 ì‹¤ì‹œê°„ í‘œì‹œ

```
================================================================================
                        ğŸ¯ Bottom Pullback ì‹ í˜¸ ëŒ€ê¸° ì¤‘
================================================================================

  ì¢…ëª©: ì˜¤ë¦„í…Œë¼í“¨í‹± (475830)
  ìƒíƒœ: WAIT_PULLBACK
  ì‹ í˜¸ê°€: 95,000ì›
  ì‹ í˜¸ ì €ê°€: 94,500ì›
  ì‹ í˜¸ VWAP: 94,800ì›
  ê²½ê³¼ ì‹œê°„: 15ë¶„

  í˜„ì¬ê°€: 94,700ì›
  í˜„ì¬ VWAP: 94,800ì›
  â†’ VWAP ì´íƒˆ ëŒ€ê¸° ì¤‘
```

### 7.2 ìƒíƒœ ë³€ê²½ ë¡œê·¸

```
[09:15] ğŸ¯ Bottom ì‹ í˜¸ ë“±ë¡: ì˜¤ë¦„í…Œë¼í“¨í‹± (475830)
        ì‹ í˜¸ ê°€ê²©: 95,000ì›
        ì‹ í˜¸ ì €ê°€: 94,500ì›
        ì‹ í˜¸ VWAP: 94,800ì›
        ìƒíƒœ: WAIT_PULLBACK

[09:30] ğŸ“‰ ì˜¤ë¦„í…Œë¼í“¨í‹± (475830): VWAP ì´íƒˆ ê°ì§€
        (94,600 < 94,800)
        ìƒíƒœ: PULLBACK_DETECTED

[09:45] âœ… Bottom Pullback ì™„ë£Œ: ì˜¤ë¦„í…Œë¼í“¨í‹± (475830)
        ì‹ í˜¸ê°€: 95,000ì›
        í˜„ì¬ê°€: 94,950ì›
        VWAP: 94,800ì›
        ê±°ë˜ëŸ‰ ë°°ìœ¨: 1.2x (ê¸°ì¤€: 1.0x)
        â†’ ë§¤ìˆ˜ ì§„ì… ê°€ëŠ¥!
        ìƒíƒœ: READY_TO_ENTER
```

---

## 8. ì„±ëŠ¥ ë¶„ì„

### 8.1 ê¸°ëŒ€ íš¨ê³¼

**ì¥ì **:
- âœ… ì €ì  ì§€ì§€ í™•ì¸ í›„ ì§„ì… â†’ ë¦¬ìŠ¤í¬ ê°ì†Œ
- âœ… VWAP ì¬ëŒíŒŒ í™•ì¸ â†’ ì¶”ì„¸ ì „í™˜ ì‹ ë¢°ë„ â†‘
- âœ… ê±°ë˜ëŸ‰ ì¡°ê±´ â†’ í—ˆìœ„ ëŒíŒŒ ë°©ì§€
- âœ… ì¼ì¼ 1íšŒ ì œí•œ â†’ ê³¼ë„í•œ ê±°ë˜ ë°©ì§€

**ë‹¨ì **:
- âŒ ì§„ì… ê¸°íšŒ ê°ì†Œ (ëŒ€ê¸° í•„ìš”)
- âŒ ë¹ ë¥¸ ìƒìŠ¹ ì‹œ ì§„ì… ë†“ì¹  ìˆ˜ ìˆìŒ
- âŒ ë³µì¡í•œ ìƒíƒœ ê´€ë¦¬ í•„ìš”

### 8.2 ì í•©í•œ ì‹œì¥ í™˜ê²½

**ì í•©**:
- ë³€ë™ì„±ì´ ìˆëŠ” ì‹œì¥
- ì§€ì§€/ì €í•­ì´ ëª…í™•í•œ ì¢…ëª©
- ê±°ë˜ëŸ‰ì´ ì¶©ë¶„í•œ ì¢…ëª©

**ë¶€ì í•©**:
- ê¸‰ë“±ì£¼ (ì¶”ê²© í•„ìš”)
- ê±°ë˜ëŸ‰ ë¶€ì¡± ì¢…ëª©
- íš¡ë³´ ì¥ì„¸

---

## 9. ê°œì„  ë°©í–¥

### 9.1 ë‹¨ê¸° ê°œì„ 

1. **Volume Profile ì¶”ê°€**
   - ì‹ í˜¸ë´‰ ê±°ë˜ëŸ‰ ë¶„í¬ ë¶„ì„
   - ì§€ì§€ êµ¬ê°„ ëª…í™•í™”

2. **ë‹¤ì¤‘ Pullback ì§€ì›**
   - 1ì°¨ Pullback ì‹¤íŒ¨ ì‹œ 2ì°¨ ê¸°íšŒ
   - ë‹¨, ì €ê°€ ìœ ì§€ ì¡°ê±´ ê°•í™”

3. **ë™ì  ì‹œê°„ ì œí•œ**
   - ë³€ë™ì„±ì— ë”°ë¼ ëŒ€ê¸° ì‹œê°„ ì¡°ì •
   - ê³ ë³€ë™ì„±: ì§§ì€ ëŒ€ê¸°
   - ì €ë³€ë™ì„±: ê¸´ ëŒ€ê¸°

### 9.2 ì¥ê¸° ê°œì„ 

1. **ML ê¸°ë°˜ ì‹ í˜¸ ì ìˆ˜**
   - Pullback ì„±ê³µ í™•ë¥  ì˜ˆì¸¡
   - ê³¼ê±° ë°ì´í„° í•™ìŠµ

2. **ë‹¤ì–‘í•œ Pullback íƒ€ì…**
   - VWAP Pullback (í˜„ì¬)
   - Support Level Pullback
   - Moving Average Pullback

3. **ë°±í…ŒìŠ¤íŠ¸ ì‹œìŠ¤í…œ**
   - ê³¼ê±° ë°ì´í„° ê²€ì¦
   - ìµœì  íŒŒë¼ë¯¸í„° íƒìƒ‰

---

## 10. ì°¸ê³  ìë£Œ

- `main_auto_trading.py` - í†µí•© ë¡œì§
- `config/strategy_hybrid.yaml` - ì„¤ì • íŒŒì¼
- `TRADING_SYSTEM_OVERVIEW.md` - ì‹œìŠ¤í…œ ì „ì²´ ê°œìš”
