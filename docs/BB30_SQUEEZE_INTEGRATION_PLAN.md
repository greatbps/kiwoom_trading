# BB(30,1) + Squeeze Momentum 통합 전략 설계

## 1. 전략 개요

### 핵심 아이디어
- **Squeeze Momentum**: 변동성 압축 상태 감지 (에너지 축적)
- **BB(30,1)**: 폭발 시작 순간 포착 (트리거)
- **결합**: 압축된 에너지가 폭발하는 "정확한 순간" 진입

### 기대 효과
| 항목 | 기존 Squeeze Only | BB(30,1) 결합 |
|------|-------------------|---------------|
| 가짜 신호 | 많음 | 감소 |
| 진입 타이밍 | 애매함 | 명확함 |
| 승률 | 40-50% | 50-65% |

---

## 2. 진입 조건 (4단계 필터)

```
[1단계] 상위 TF 추세 필터 (30분봉)
         ↓
[2단계] Squeeze 상태 확인 (5분봉)
         ↓
[3단계] 모멘텀 방향 확인
         ↓
[4단계] BB(30,1) 돌파 트리거
         ↓
       진입
```

### 2.1 상위 TF 추세 필터 (기존 활용)
```python
# 30분봉 기준 (squeeze_2tf에서 이미 사용 중)
- MA5 > MA20: 상승 추세 → 롱만 허용
- MA5 < MA20: 하락 추세 → 진입 금지 (롱온리)
```

### 2.2 Squeeze 상태 확인
```python
# LazyBear Squeeze Momentum
- squeeze_on: BB(20,2) 내부에 Keltner(20,1.5) 존재
- 조건: 연속 5봉 이상 squeeze_on 유지
- 색상: Bright Green (모멘텀 상승 중)
```

### 2.3 모멘텀 방향 확인
```python
# Squeeze 히스토그램
- 현재값 > 0
- 현재값 > 이전값 (증가 중)
```

### 2.4 BB(30,1) 돌파 트리거 (NEW)
```python
# 볼린저 밴드 (30, 1)
- 종가 > BB_Upper(30, 1) → 롱 진입
- 종가 < BB_Lower(30, 1) → (롱온리라 무시)
```

---

## 3. 청산 조건

### 3.1 익절
```python
# 1차 익절: RR 1.5 도달 시 50% 청산
# 2차 익절: 트레일링 스탑 (BB 중심선 or ATR 기반)
```

### 3.2 손절
```python
# 조건 (둘 중 하나 먼저)
1. 종가 < BB(30,1) 중심선 (Mid)
2. ATR × 1.2 손실 도달
```

### 3.3 시간 청산
```python
# 기존 로직 유지
- 15:00 강제 청산 (당일 매수 종목)
```

---

## 4. 구현 계획

### 4.1 파일 구조
```
analyzers/
├── squeeze_momentum_lazybear.py  # 기존
├── bb_squeeze_strategy.py        # NEW: BB(30,1) + Squeeze 통합
└── ...
```

### 4.2 설정 (strategy_hybrid.yaml)
```yaml
bb_squeeze:
  enabled: true

  # 볼린저 밴드 설정
  bb_length: 30
  bb_std: 1.0

  # Squeeze 연속성
  min_squeeze_bars: 5

  # 모멘텀 필터
  require_momentum_increase: true

  # 손절/익절
  stop_loss_atr_mult: 1.2
  take_profit_rr: 1.5
```

### 4.3 entry_mode 추가
```yaml
squeeze_momentum:
  entry_mode: "bb_squeeze"  # NEW: BB(30,1) + Squeeze 결합
```

---

## 5. 기존 전략과의 비교

| 항목 | squeeze_2tf | smc | bb_squeeze (NEW) |
|------|-------------|-----|------------------|
| 진입 기준 | 30분봉 골든크로스 + Squeeze | CHoCH + OB | Squeeze + BB(30,1) 돌파 |
| 철학 | 추세 확인 후 | 세력 의도 해석 | 폭발 시작 포착 |
| 복잡도 | 중간 | 높음 | 낮음 |
| 승률 기대 | 50-60% | 60-70% | 50-65% |
| 거래 빈도 | 중간 | 낮음 | 낮음 |

---

## 6. 예상 시나리오

### 성공 케이스
```
09:30 - Squeeze ON (5봉 연속)
09:35 - 모멘텀 양수, 증가 중
09:40 - 종가가 BB(30,1) 상단 돌파 → 진입!
10:15 - RR 1.5 도달 → 50% 익절
11:00 - BB 중심선 터치 → 잔여 청산
결과: +2.5%
```

### 실패 케이스 (필터로 차단)
```
11:00 - Squeeze ON
11:05 - 모멘텀 양수
11:10 - BB(30,1) 돌파
❌ 하지만 30분봉 MA5 < MA20 (하락 추세)
→ 진입 차단
```

---

## 7. 리스크 관리

### 연속 손절 방지
```python
# 당일 연속 2회 손절 시 → 거래 중단
# ATR 하위 20% 구간 → 진입 금지
```

### 시간대 필터
```python
# 점심시간 (12:00-13:00): 진입 차단 (기존 유지)
# 골든타임 (10:00-10:30): 신뢰도 가중치 (기존 유지)
```

---

## 8. 구현 우선순위

1. **Phase 1**: BB(30,1) 계산 모듈 추가
2. **Phase 2**: Squeeze 상태와 결합 로직
3. **Phase 3**: 진입/청산 통합
4. **Phase 4**: 백테스트 및 파라미터 튜닝
5. **Phase 5**: 실전 적용 (entry_mode 추가)

---

## 9. 백테스트 계획

```python
# 테스트 기간: 최근 3개월
# 테스트 종목: 조건검색 상위 종목
# 비교 대상:
#   - squeeze_2tf (기존)
#   - bb_squeeze (신규)
#   - smc (신규)
```

---

## 10. 결론

BB(30,1)은 **단독 전략이 아닌 "진입 트리거"**로 사용할 때 가치가 있음.
기존 Squeeze Momentum과 결합하면:
- 가짜 신호 감소
- 진입 타이밍 명확화
- 승률/손익비 개선 기대
