# CONFIDENCE 임계값 조정 권장사항

**작성일**: 2025-11-28
**분석 기반**: 2025-11-28 실거래 데이터 (14건 거래, 2,577회 평가)

---

## 📊 현황 분석

### 현재 설정
- **MIN_CONFIDENCE**: 0.4
- **총 평가**: 2,577회
- **ACCEPT**: 1,690회 (65.6%)
- **REJECT**: 887회 (34.4%)
  - CONFIDENCE 부족: **490회 (55.2%)**
  - L0 필터: 397회 (44.8%)

### CONFIDENCE 차단 분포

```
confidence   차단 건수   비율   누적
─────────────────────────────────
0.40         39건      8.0%   8.0%   ← 임계값
0.39         60건     12.2%  20.2%
0.38         92건     18.8%  39.0%   ← 최다 차단
0.37         74건     15.1%  54.1%
0.36         78건     15.9%  70.0%
0.35         49건     10.0%  80.0%   ← 제안 임계값
─────────────────────────────────
0.34         32건      6.5%  86.5%
0.33         20건      4.1%  90.6%
0.32         16건      3.3%  93.9%
0.31         17건      3.5%  97.3%
0.30         13건      2.7% 100.0%
─────────────────────────────────
합계        490건    100.0%
```

### 핵심 발견

1. **80% (392건)가 0.35-0.40 구간**
   - 이들은 "낮은 신뢰도"가 아닌 "경계선 고품질 신호"
   - 0.38-0.40: 191건 (39%) - 임계값 바로 아래
   - 0.35-0.37: 201건 (41%) - 임계값 근처

2. **실제 저품질 신호는 20%뿐** (<0.35)
   - 0.30-0.34: 98건만 진짜 낮은 신뢰도

3. **승인된 거래의 confidence 분포**
   ```
   318060: conf=0.40 (임계값)  → 1주 매수 성공
   318060: conf=0.45           → 1주 매수 성공
   318060: conf=0.49           → 1주 매수 성공
   092200: conf=0.57           → 1주 매수 성공
   ```

4. **Confidence 변동성 관찰**
   ```
   14:57:59 - ❌ REJECT 318060 @19720원 | conf=0.37
   14:58:45 - ❌ REJECT 318060 @19730원 | conf=0.38
   14:57:45 - ✅ ACCEPT 318060 @19740원 | conf=0.40
   ```
   → 동일 종목이 수 초 내에 0.37 → 0.40으로 변동
   → 0.03 차이로 거래 기회 상실

---

## 💡 권장사항: MIN_CONFIDENCE 0.4 → 0.35 조정

### 조정 근거

#### 1. 데이터 기반 분석
- **80%의 차단이 경계선 신호** (0.35-0.40)
- **현재 승인 거래의 최저값이 0.40** (임계값)
- **0.35-0.40 구간 = 392건의 잠재 거래 기회**

#### 2. 현재 시스템 성과
```
오늘 실거래 결과 (2025-11-28):
- 총 거래: 14건 (7 매수, 7 매도)
- 승률: 75% (6승 2패)
- 일일 수익: +5,250원 (+1.35%)
- 최고 수익: +3,100원 (+3.75%)
- Early Failure Cut 작동: -600원 (-0.66%)
```

→ **75% 승률 시스템이 0.35-0.40 신호를 처리할 수 있음**

#### 3. 다층 안전망 존재
```
L0: 진입 시간, 일일 거래 횟수, 가격대
L1: 포지션 수, 최대 거래 금액
L2: 리스크 관리 (쿨다운, 손절)
L3: 뉴스 필터, 금지 종목
L4: 가격 검증, 유동성
L5: 종합 평가, 손절가 계산
L6: CONFIDENCE (현재 논의 대상)
Early Failure Cut: 4분 -0.66% 손절
```

→ **CONFIDENCE 외에도 5개 레이어 + 손절 장치**

#### 4. 자본 효율성 개선
- 현재: 65.6% 승인율
- 조정 시: 약 **80-85% 승인율** (추정)
- 효과: **더 많은 거래 기회 = 수익 증대**

---

## 🔧 구현 방법

### 파일 수정: `analyzers/signal_orchestrator.py`

**현재 코드** (Line ~560):
```python
MIN_CONFIDENCE = 0.4  # ← 여기 수정
```

**수정 후**:
```python
MIN_CONFIDENCE = 0.35  # 🔧 2025-11-28: 경계선 신호 포함 (0.4 → 0.35)
```

### 수정 사항
1. MIN_CONFIDENCE = 0.35로 변경
2. 주석 추가로 변경 이유 기록
3. 재시작 후 모니터링

---

## 📈 예상 효과

### 긍정적 효과
1. **거래 기회 증가**: 392건/일 추가 승인 (490건 → 98건 차단)
2. **자본 효율 개선**: 유휴 자금 감소
3. **수익 증대 가능성**: 75% 승률 유지 시 추가 수익
4. **변동성 대응**: Confidence 미세 변동에 덜 민감

### 리스크 및 완화 방안
| 리스크 | 완화 방안 |
|--------|-----------|
| 저품질 신호 증가 | L0-L5 필터로 1차 차단 |
| 손실 증가 가능성 | Early Failure Cut (-0.66%) 작동 |
| 과다 거래 | L0 일일 거래 횟수 제한 (3회) |
| 쿨다운 무시 | 파일 기반 쿨다운으로 강제 (이미 구현) |

---

## 🧪 모니터링 계획

### 조정 후 1주일간 모니터링
```bash
# 일일 통계 확인
grep "✅ ACCEPT\|❌ REJECT" logs/signal_orchestrator.log | \
  grep $(date +%Y-%m-%d) | wc -l

# Confidence 분포 확인
grep "conf=" logs/signal_orchestrator.log | \
  grep -oP "conf=\d+\.\d+" | cut -d= -f2 | sort | uniq -c

# 승률 확인 (data/risk_log.json)
python3 -c "
import json
data = json.load(open('data/risk_log.json'))
wins = sum(1 for t in data['trades'] if 'sell_price' in t and t['sell_price'] > t['buy_price'])
total = sum(1 for t in data['trades'] if 'sell_price' in t)
print(f'승률: {wins}/{total} = {wins/total*100:.1f}%')
"
```

### 성과 지표
- **승률**: 70% 이상 유지 (현재 75%)
- **일일 수익**: 평균 +1% 이상
- **Confidence 분포**: 0.35-0.40 승인 비율 증가
- **Early Failure Cut**: 작동 빈도 모니터링

### 롤백 조건
다음 중 하나라도 발생 시 0.4로 복귀:
1. 승률 60% 미만으로 하락 (3일 연속)
2. 일일 손실 -5% 이상 (2일 연속)
3. Early Failure Cut 발동 50% 이상 (과도한 손절)

---

## 🎯 결론

### 권장 조치
✅ **MIN_CONFIDENCE를 0.4에서 0.35로 조정**

### 이유 요약
1. 차단된 신호의 80%가 경계선 고품질 (0.35-0.40)
2. 현재 시스템 승률 75% - 안정적
3. 다층 안전망 존재 (L0-L5 + Early Failure Cut)
4. 자본 효율성 개선 필요
5. 동일 종목 confidence 변동성 관찰 (0.37 → 0.40)

### 대안 (ChatGPT 제안)
- **Option B**: 다중 컴포넌트 신뢰도 점수
  - 모멘텀 40% + 거래량 25% + 뉴스 20% + 변동성 10% + 리스크 5%
  - **평가**: 복잡도 증가, 현재 단순 조정으로 충분

**최종 권장**: Option A (0.35 조정) 먼저 시도 → 1주일 모니터링 → 필요시 Option B 검토

---

**작성자**: Claude Code
**승인 필요**: 사용자 확인 후 적용
**적용 예정일**: 2025-11-28 (즉시)
