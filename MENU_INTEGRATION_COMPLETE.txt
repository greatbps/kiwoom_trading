================================================================================
메뉴 통합 완료 보고서 - SignalOrchestrator L0-L6
================================================================================

✅ 완료일시: 2025-11-16
✅ 통합 버전: v1.1 (메뉴 통합)
✅ 상태: 메뉴 핸들러 구현 완료

================================================================================
메뉴 옵션 변경사항
================================================================================

이전 메뉴 구조:
  1. 🤖 자동 매매 시작
  2. 🔍 조건 검색 실행
  3. 📊 Ranker 학습
  ...

새 메뉴 구조:
  1. 🤖 자동 매매 시작 (기본 모드)
  2. 🔍 백테스트 검증 모드 (L0-L6 시그널 확인)
  3. 🚀 실전 투입 모드 (L0-L6 + 실제 매매)
  4. 📊 Ranker 학습 (Candidate Ranker)
  5. 🧪 Ranker 테스트 (예측 및 랭킹)
  6. 📈 백테스트 실행
  7. 📄 리포트 생성 (일일/주간)
  8. 💬 Telegram 알림 테스트
  9. ⚙️  시스템 설정
  h. 📚 도움말
  0. 🚪 종료

================================================================================
새로 추가된 함수
================================================================================

1. run_dry_run_mode() (main_menu.py:122-172)
   목적: 백테스트 검증 모드 실행

   동작:
   - 사용자에게 조건식 인덱스 입력 요청 (기본: 0,1,2)
   - sys.argv 조작하여 --dry-run 플래그 전달
   - main_auto_trading.main() 호출
   - L0-L6 파이프라인 실행하되 실제 주문은 생략
   - 원래 sys.argv 복원

   사용 예시:
   - 메뉴에서 [2] 선택
   - 조건식 입력: "0,1,2" 또는 "17,18,19,20,21,22"
   - SignalOrchestrator 동작 확인
   - 매수 시그널 로그만 출력, 주문 미실행

2. run_live_mode() (main_menu.py:175-235)
   목적: 실전 투입 모드 실행

   동작:
   - ⚠️ 경고 메시지 출력
   - "yes" 입력 확인 (안전장치)
   - 사용자에게 조건식 인덱스 입력 요청 (기본: 17,18,19,20,21,22)
   - sys.argv 조작하여 --live 플래그 전달
   - main_auto_trading.main() 호출
   - L0-L6 파이프라인 + 실제 매수/매도 실행
   - 원래 sys.argv 복원

   사용 예시:
   - 메뉴에서 [3] 선택
   - 확인 프롬프트: "yes" 입력
   - 조건식 입력: "17,18,19,20,21,22"
   - 실제 매매 실행

================================================================================
main() 함수 수정사항
================================================================================

main_menu.py:1184-1205

변경 전:
  elif choice == '2':
      await run_condition_search()
  elif choice == '3':
      from ml_train_menu import train_ranker_menu
      await train_ranker_menu()
  ...
  elif choice == '9':
      show_help()

변경 후:
  elif choice == '2':
      await run_dry_run_mode()
  elif choice == '3':
      await run_live_mode()
  elif choice == '4':
      from ml_train_menu import train_ranker_menu
      await train_ranker_menu()
  ...
  elif choice == 'h':
      show_help()

주요 변경:
- 옵션 2: run_condition_search → run_dry_run_mode
- 옵션 3: train_ranker_menu → run_live_mode
- 옵션 4~9: 기존 3~8 메뉴 이동
- 도움말: '9' → 'h'

================================================================================
기술적 구현 방식
================================================================================

sys.argv 조작 패턴:

1. 백테스트 검증 모드:
   original_argv = sys.argv.copy()
   sys.argv = ['main_auto_trading.py', '--dry-run', '--conditions', '0,1,2']
   await main_auto_trading.main()
   sys.argv = original_argv

2. 실전 투입 모드:
   original_argv = sys.argv.copy()
   sys.argv = ['main_auto_trading.py', '--live', '--conditions', '17,18,19,20,21,22']
   await main_auto_trading.main()
   sys.argv = original_argv

이점:
- 기존 argparse 로직 그대로 재사용
- main_auto_trading.py 수정 불필요
- 메뉴와 CLI 양쪽에서 동일한 코드 사용

================================================================================
사용 시나리오
================================================================================

시나리오 1: 백테스트 검증
  1. python3 main_menu.py 실행
  2. 메뉴에서 [2] 선택
  3. 조건식 입력: "0,1,2"
  4. L0-L6 파이프라인 로그 확인
  5. 시그널 검출 확인 (주문 미실행)
  6. Enter 키로 메뉴 복귀

시나리오 2: 실전 투입 (월요일 09:00)
  1. python3 main_menu.py 실행
  2. 메뉴에서 [3] 선택
  3. 경고 확인 후 "yes" 입력
  4. 조건식 입력: "17,18,19,20,21,22"
  5. 실제 매매 시작
  6. Ctrl+C로 안전 종료

시나리오 3: CLI 직접 실행 (기존 방식 유지)
  python3 main_auto_trading.py --dry-run --conditions 0,1,2
  python3 main_auto_trading.py --live --conditions 17,18,19,20,21,22

================================================================================
안전장치
================================================================================

1. 실전 투입 모드 확인 프롬프트
   - "yes" 정확히 입력해야 진행
   - 대소문자 구분 없음 (lower() 처리)
   - 다른 입력 시 즉시 취소

2. sys.argv 복원
   - try-finally 블록으로 보장
   - 예외 발생 시에도 원래 argv 복원

3. KeyboardInterrupt 처리
   - Ctrl+C 시 안전 종료
   - 상태 메시지 출력

================================================================================
검증 방법
================================================================================

1. 메뉴 테스트
   python3 main_menu.py

   체크사항:
   - 메뉴 항목 정상 출력
   - [2] 선택 시 백테스트 모드 진입
   - [3] 선택 시 확인 프롬프트 출력
   - 각 옵션 정상 동작

2. 백테스트 검증 모드 테스트
   python3 main_menu.py
   → [2] 선택
   → 조건식: "0,1,2"

   예상 로그:
   - SignalOrchestrator 초기화
   - L0-L6 필터 실행
   - 🔍 [DRY-RUN] 백테스트 모드: 실제 주문 생략
   - 예상 수량/금액 출력

3. 실전 투입 모드 테스트 (주의!)
   python3 main_menu.py
   → [3] 선택
   → "yes" 입력
   → 조건식: "17,18,19,20,21,22"

   ⚠️ 실제 계좌에서 주문 실행됨!

================================================================================
다음 단계
================================================================================

1. 메뉴 테스트 (권장)
   python3 main_menu.py
   - 메뉴 표시 확인
   - 옵션 2, 3 동작 확인
   - sys.argv 복원 확인

2. 백테스트 검증 (월요일 이전)
   python3 main_menu.py → [2]
   - L0-L6 파이프라인 정상 동작 확인
   - 조건식별 시그널 검출 확인
   - 포지션 크기 계산 확인

3. 실전 투입 (월요일 09:00)
   python3 main_menu.py → [3]
   - 실제 계좌 잔고 확인
   - 조건식 최종 선정
   - 실시간 모니터링

================================================================================
주의사항
================================================================================

⚠️ 실전 투입 전 필수 확인
   - 계좌 잔고 충분한지 확인
   - max_daily_loss_pct: 3.0% 확인 (config/strategy_hybrid.yaml)
   - 조건식 인덱스 정확성 확인
   - 백테스트 검증 모드로 먼저 테스트

⚠️ 메뉴 옵션 재배치
   - 기존 [3]~[8] → 새로운 [4]~[9]
   - 기존 [9] (도움말) → 새로운 [h]
   - 사용자 매뉴얼 업데이트 필요

⚠️ CLI 실행도 여전히 가능
   - 메뉴 통합이 CLI 실행을 대체하지 않음
   - 스크립트/크론잡 등에서는 CLI 사용 권장
   - 수동 실행 시 메뉴 사용 권장

================================================================================
수정된 파일
================================================================================

1. main_menu.py (3개 수정)
   - run_dry_run_mode() 함수 추가 (line 122-172)
   - run_live_mode() 함수 추가 (line 175-235)
   - main() 함수 수정 (line 1184-1205)

기존 파일 (변경 없음):
- main_auto_trading.py (argparse 로직 그대로 사용)
- config/strategy_hybrid.yaml
- analyzers/signal_orchestrator.py

문서:
- MENU_INTEGRATION_COMPLETE.txt (이 문서)
- INTEGRATION_SUMMARY.txt (기존 통합 요약)
- docs/INTEGRATION_COMPLETE.md (상세 가이드)

================================================================================
연락처
================================================================================

문제 발생 시:
1. main_menu.py의 run_dry_run_mode/run_live_mode 함수 확인
2. sys.argv 복원 정상 동작 확인
3. 로그 확인: logs/ 디렉토리

작성일: 2025-11-16
작성자: Claude Code Assistant
버전: 메뉴 통합 v1.1

================================================================================
